{"version":3,"file":"WebStats-dist.js","sources":["src/Connection.ts","src/Data.ts","src/FormattingCodes.ts","src/Display.ts","src/Pagination.ts","src/WebStats.ts"],"sourcesContent":["export default class Connection {\r\n\tall: string\r\n\tscores: string\r\n\tonline: string\r\n\ttables: string\r\n\r\n\tconstructor({ all, scores, online, tables }) {\r\n\t\tthis.all = all\r\n\t\tthis.scores = scores\r\n\t\tthis.online = online\r\n\t\tthis.tables = tables\r\n\t}\r\n\r\n\tstatic json(host: string) {\r\n\t\treturn new Connection({\r\n\t\t\tall:  `http://${host}/stats.json`,\r\n\t\t\tscores:  `http://${host}/scoreboard.json`,\r\n\t\t\tonline:  `http://${host}/online.json`,\r\n\t\t\ttables:  `http://${host}/tables.json`,\r\n\t\t})\r\n\t}\r\n\r\n\tgetStats = async () => {\r\n\t\tif (this.all) {\r\n\t\t\treturn await (await fetch(this.all)).json()\r\n\t\t} else {\r\n\t\t\tconst [online, scoreboard] = await Promise.all([this.getOnline(), this.getScoreboard()])\r\n\t\t\treturn { online, scoreboard }\r\n\t\t}\r\n\t}\r\n\tgetScoreboard = () => fetch(this.scores).then(response => response.json()).catch(() => {})\r\n\tgetOnline = () => fetch(this.online).then(response => response.json()).catch(() => {})\r\n\tgetTables = () => fetch(this.tables).then(response => response.json()).catch(() => {})\r\n}\r\n","type Scoreboard = {\r\n\tentries: string[],\r\n\tscores: { [column: string]: { [entry: string]: string } },\r\n\tcolumns?: string[]\r\n}\r\ntype Online = { [player: string]: boolean | \"afk\" }\r\ntype Entry = [number, string, ...(string)[]]\r\n\r\nexport default class Data {\r\n\tscoreboard: Scoreboard\r\n\tcolumns: string[]\r\n\tscores: Entry[]\r\n\tplayers: Online\r\n\tcolumns_: { [column: string]: number }\r\n\tplayernames: string[]\r\n\tbedrockPrefix?: string\r\n\r\n\tconstructor(data: { scoreboard: Scoreboard, online: Online, playernames: string[], bedrockPrefix?: string }) {\r\n\t\tthis.setStats(data)\r\n\t}\r\n\r\n\tget entries() { return this.scoreboard.entries }\r\n\tget online() { return this.players }\r\n\tget nOnline() { return Object.keys(this.players).length }\r\n\r\n\tisOnline = (player: string) => this.players[player] === true\r\n\tisAFK = (player: string) => this.players[player] === \"afk\"\r\n\tisOffline = (player: string) => !!this.players[player]\r\n\tgetStatus = (player: string) => this.isOnline(player) ? \"online\"\r\n\t\t: (this.isAFK(player) ? \"AFK\" : \"offline\")\r\n\tisCurrentPlayer = (player: string) => this.playernames?.includes(player) ?? false\r\n\r\n\tsetScoreboard(scoreboard: Scoreboard) {\r\n\t\tthis.scoreboard = scoreboard\r\n\t\tthis.columns = Object.keys(scoreboard.scores).sort()\r\n\r\n\t\tthis.filter()\r\n\r\n\t\tthis.scores = []\r\n\t\tfor (const entryName of this.entries) {\r\n\t\t\tconst entry = []\r\n\t\t\tentry.push(this.scores.push(entry as Entry) - 1)\r\n\t\t\tentry.push(entryName)\r\n\t\t\tfor (const columnName of this.columns) {\r\n\t\t\t\tentry.push(this.scoreboard.scores[columnName]?.[entryName] ?? 0)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Reverse-map column names to indices\r\n\t\t// (index 0 contains the original index, before sorting)\r\n\t\tthis.columns_ = { Player: 1 }\r\n\t\tthis.columns.forEach((val, idx) => this.columns_[val] = idx + 2)\r\n\t}\r\n\tsetOnlineStatus(online: Online) { this.players = online }\r\n\tsetPlayernames(playernames: string[]) { this.playernames = playernames }\r\n\tsetStats(data: { scoreboard: Scoreboard, online: Online, playernames: string[], bedrockPrefix?: string }) {\r\n\t\tthis.bedrockPrefix = data.bedrockPrefix\r\n\t\tthis.setScoreboard(data.scoreboard)\r\n\t\tthis.setOnlineStatus(data.online)\r\n\t\tthis.setPlayernames(data.playernames)\r\n\t}\r\n\r\n\tfilter() {\r\n\t\t// Remove non-player / empty entries and sort\r\n\t\tthis.scoreboard.entries = this.scoreboard.entries\r\n\t\t\t.filter(this.isPlayerOrServer.bind(this))\r\n\t\t\t.filter(this.isNonemptyEntry.bind(this))\r\n\t\t\t.sort(Intl.Collator().compare)\r\n\r\n\t\t// Remove empty columns\r\n\t\tthis.scoreboard.scores = Data.filter(this.scoreboard.scores, this.isNonemptyObjective.bind(this))\r\n\t}\r\n\r\n\tsort(by: string, descending: boolean) {\r\n\t\t// Pre-create collator for significant performance improvement\r\n\t\t// over `a.localeCompare(b, undefined, {sensitivity: \"base\"})`\r\n\t\t// funny / weird thing: for localeCompare, supplying an empty `options`\r\n\t\t// object is way slower than supplying nothing...\r\n\t\tconst collator = new Intl.Collator(undefined, { sensitivity: \"base\" })\r\n\r\n\t\t// When a and b are both numbers, compare as numbers.\r\n\t\t// Otherwise, case-insensitive compare as string\r\n\t\tthis.scores = this.scores.sort((a_row, b_row) => {\r\n\t\t\tconst a = a_row[this.columns_[by]]\r\n\t\t\tconst b = b_row[this.columns_[by]]\r\n\t\t\tif (!isNaN(Number(a)) && !isNaN(Number(b))) {\r\n\t\t\t\treturn (descending ? -1 : 1) * ((a as number) - (b as number))\r\n\t\t\t} else {\r\n\t\t\t\treturn (descending ? -1 : 1) * collator.compare(a as string, b as string)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t// Ignore all entries which have no scores (armour stand book fix)\r\n\t// (also hides entries with only 0 values)\r\n\tisNonemptyEntry = (entry: string) => Object.entries(this.scoreboard.scores)\r\n\t\t.filter(([_, score]) => score[entry] && score[entry] != \"0\").length > 0\r\n\r\n\t// Valid player names only contain between 3 and 16 characters [A-Za-z0-9_],\r\n\t// entries with only digits are ignored as well (common for datapacks)\r\n\tisPlayerOrServer = (entry: string) =>\r\n\t\tentry == \"#server\" || (entry.match(/^\\w{3,16}$/) && !entry.match(/^\\d*$/))\r\n\t\t|| this.isBedrockPlayer(entry)\r\n\t\r\n\t// Whether this entry is a Bedrock player through Geyser/Floodgate\r\n\tisBedrockPlayer = (entry: string) => (this.bedrockPrefix && entry.startsWith(this.bedrockPrefix))\r\n\r\n\t// Whether any entry has a value for this objective\r\n\tisNonemptyObjective = (objective: { [entry: string]: string | number }) =>\r\n\t\tObject.keys(objective).filter(this.isPlayerOrServer.bind(this)).length > 0\r\n\t\r\n\t// Transform a Bedrock player's name mangled by Geyser/Floodgate back to a real name\r\n\tstatic transformBedrockPlayername = (entry: string) =>\r\n\t\tentry.substring(1).replaceAll(\"_\", \" \")\r\n\r\n\t// Array-like filter function for objects\r\n\t// https://stackoverflow.com/a/37616104\r\n\tstatic filter = <V>(obj: { [k: string]: V }, predicate: (_: V) => boolean): { [k: string]: V } =>\r\n\t\tObject.fromEntries(Object.entries(obj).filter(([_, v]) => predicate(v)))\r\n\r\n\t// Likewise, array-like map function for objects\r\n\tstatic map = <V>(obj: { [k: string]: V }, mapper: (k: string, v: V) => V) =>\r\n\t\tObject.fromEntries(Object.entries(obj).map(([k, v]) => [k, mapper(k, v)]))\r\n\r\n}\r\n","type ColourCode =\r\n\t| \"§0\"\r\n\t| \"§1\"\r\n\t| \"§2\"\r\n\t| \"§3\"\r\n\t| \"§4\"\r\n\t| \"§5\"\r\n\t| \"§6\"\r\n\t| \"§7\"\r\n\t| \"§8\"\r\n\t| \"§9\"\r\n\t| \"§a\"\r\n\t| \"§b\"\r\n\t| \"§c\"\r\n\t| \"§d\"\r\n\t| \"§e\"\r\n\t| \"§f\"\r\n\r\ntype FormattingCode =\r\n\t| \"§k\"\r\n\t| \"§l\"\r\n\t| \"§m\"\r\n\t| \"§n\"\r\n\t| \"§o\"\r\n\t| \"§r\"\r\n\r\ntype FormattingCodePart = {\r\n\ttext: string\r\n\tformat?: FormattingCode\r\n\tcolour?: ColourCode | string\r\n\tcolourType?: \"simple\" | \"hex\"\r\n}\r\n\r\nexport default class FormattingCodes {\r\n\tstatic COLOUR_CODES: {[code in ColourCode]: string} = {\r\n\t\t[\"§0\"]: \"black\",\r\n\t\t[\"§1\"]: \"dark_blue\",\r\n\t\t[\"§2\"]: \"dark_green\",\r\n\t\t[\"§3\"]: \"dark_aqua\",\r\n\t\t[\"§4\"]: \"dark_red\",\r\n\t\t[\"§5\"]: \"dark_purple\",\r\n\t\t[\"§6\"]: \"gold\",\r\n\t\t[\"§7\"]: \"gray\",\r\n\t\t[\"§8\"]: \"dark_gray\",\r\n\t\t[\"§9\"]: \"blue\",\r\n\t\t[\"§a\"]: \"green\",\r\n\t\t[\"§b\"]: \"aqua\",\r\n\t\t[\"§c\"]: \"red\",\r\n\t\t[\"§d\"]: \"light_purple\",\r\n\t\t[\"§e\"]: \"yellow\",\r\n\t\t[\"§f\"]: \"white\",\r\n\t}\r\n\r\n\tstatic FORMATTING_CODES: {[code in FormattingCode]: string} = {\r\n\t\t[\"§k\"]: \"obfuscated\",\r\n\t\t[\"§l\"]: \"bold\",\r\n\t\t[\"§m\"]: \"strikethrough\",\r\n\t\t[\"§n\"]: \"underline\",\r\n\t\t[\"§o\"]: \"italic\",\r\n\t\t[\"§r\"]: \"reset\",\r\n\t}\r\n\r\n\t// § followed by a single character, or of the form §x§r§r§g§g§b§b\r\n\t// (also capture rest of string, until next §)\r\n\tstatic FORMATTING_CODE_REGEX = /(§x§.§.§.§.§.§.|§.)([^§]*)/gm\r\n\r\n\t// Replace all formatting codes by <span> elements\r\n\tstatic convertFormattingCodes = (value: string) =>\r\n\t\tFormattingCodes.parseFormattingCodes(value).map(FormattingCodes.convertFormattingCode)\r\n\r\n\t// Convert a single formatting code to a <span> element\r\n\tstatic convertFormattingCode(part: FormattingCodePart) {\r\n\t\tif (!part.format && !part.colour) return part.text\r\n\r\n\t\tconst span = document.createElement(\"span\")\r\n\t\tspan.innerText = part.text\r\n\t\tspan.classList.add(\"mc-format\")\r\n\r\n\t\tif (part.format) span.classList.add(\"mc-\" + part.format)\r\n\t\tif (part.colour) {\r\n\t\t\tif (part.colourType == \"simple\") span.classList.add(\"mc-\" + part.colour)\r\n\t\t\tif (part.colourType == \"hex\") span.style.color = part.colour\r\n\t\t}\r\n\r\n\t\treturn span\r\n\t}\r\n\r\n\tstatic parseFormattingCodes(value: string): FormattingCodePart[] {\r\n\t\tconst parts = []\r\n\r\n\t\tconst firstIdx = value.matchAll(FormattingCodes.FORMATTING_CODE_REGEX).next().value?.index\r\n\t\tif (firstIdx == undefined || firstIdx > 0) {\r\n\t\t\tparts.push({ text: value.substring(0, firstIdx) })\r\n\t\t}\r\n\r\n\t\tfor (const match of value.matchAll(FormattingCodes.FORMATTING_CODE_REGEX)) {\r\n\t\t\tparts.push(FormattingCodes.parseFormattingCode(match[1], match[2], parts[parts.length - 1]))\r\n\t\t}\r\n\r\n\t\treturn parts\r\n\t}\r\n\r\n\tstatic parseFormattingCode(code: string, text: string, prev: FormattingCodePart): FormattingCodePart {\r\n\t\t// Simple colour codes and formatting codes\r\n\t\tif (FormattingCodes.COLOUR_CODES[code]) {\r\n\t\t\treturn {\r\n\t\t\t\ttext,\r\n\t\t\t\tcolour: FormattingCodes.COLOUR_CODES[code],\r\n\t\t\t\tcolourType: \"simple\",\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (FormattingCodes.FORMATTING_CODES[code]) {\r\n\t\t\treturn {\r\n\t\t\t\ttext,\r\n\t\t\t\tformat: FormattingCodes.FORMATTING_CODES[code],\r\n\t\t\t\tcolour: prev?.colour,\r\n\t\t\t\tcolourType: prev?.colourType,\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Hex colour codes\r\n\t\tconst matches = code.match(/§x§(.)§(.)§(.)§(.)§(.)§(.)/m)\r\n\t\tif (matches) {\r\n\t\t\treturn {\r\n\t\t\t\ttext,\r\n\t\t\t\tcolour: \"#\" + matches.slice(1).join(\"\"),\r\n\t\t\t\tcolourType: \"hex\",\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Not a valid formatting code, just return the input unaltered\r\n\t\treturn { text }\r\n\t}\r\n\r\n}\r\n","import Data from \"./Data\"\r\nimport FormattingCodes from \"./FormattingCodes\"\r\nimport Pagination from \"./Pagination\"\r\nimport { Direction, TableConfig } from \"./WebStats\"\r\n\r\nexport default class Display {\r\n\ttable: HTMLTableElement\r\n\tpagination?: Pagination\r\n\tcolumns: string[]\r\n\tsortColumn: string\r\n\tdescending: boolean\r\n\tshowSkins: boolean\r\n\thideOffline: boolean\r\n\r\n\tdata: Data\r\n\theaderElem: HTMLTableRowElement\r\n\trows: Map<string, HTMLTableRowElement>\r\n\r\n\tstatic CONSOLE_IMAGE = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAPElEQVQ4T2NUUlL6z0ABYBw1gGE0DBioHAZ3795lUFZWJildosQCRQaQoxnkVLgL0A2A8dFpdP8NfEICAMkiK2HeQ9JUAAAAAElFTkSuQmCC\"\r\n\r\n\tconstructor({ table, pagination, showSkins = true }, { columns, sortColumn = \"Player\", sortDirection = \"descending\" }: TableConfig) {\r\n\t\tthis.table = table\r\n\t\tthis.pagination = pagination\r\n\t\tthis.columns = columns\r\n\t\tthis.sortColumn = sortColumn\r\n\t\tthis.descending = sortDirection == \"descending\"\r\n\t\tthis.showSkins = showSkins\r\n\t\tthis.hideOffline = false\r\n\r\n\t\tif (this.pagination) this.pagination.onPageChange = (page) => {\r\n\t\t\tthis.updatePagination()\r\n\t\t\tthis.show()\r\n\t\t}\r\n\t}\r\n\r\n\tinit(data: Data) {\r\n\t\tthis.data = data\r\n\r\n\t\t// Set pagination controls\r\n\t\tif (this.pagination) this.updatePagination()\r\n\r\n\t\t// Create header of columns\r\n\t\tthis.headerElem = document.createElement(\"tr\")\r\n\t\tthis.table.append(this.headerElem)\r\n\t\tDisplay.appendTh(this.headerElem, \"Player\", this.thClick.bind(this),\r\n\t\t\tthis.showSkins ? 2 : undefined)\r\n\t\tfor (const column of this.columns ?? this.data.columns) {\r\n\t\t\tDisplay.appendTh(this.headerElem, column, this.thClick.bind(this))\r\n\t\t}\r\n\r\n\t\t// Create rows of (empty) entries\r\n\t\tthis.rows = new Map()\r\n\t\tfor (const entry of this.getEntries()) {\r\n\t\t\tthis.appendEntry(entry)\r\n\t\t}\r\n\r\n\t\t// Fill entries\r\n\t\tthis.updateStatsAndShow()\r\n\t}\r\n\r\n\tgetEntries() {\r\n\t\tconst entriesHere = this.data.entries.filter((entry: string) =>\r\n\t\t\t(this.columns ?? this.data.columns).some((column: string) =>\r\n\t\t\t\tthis.data.scoreboard.scores[column]?.[entry]\r\n\t\t\t\t&& this.data.scoreboard.scores[column][entry] != \"0\"))\r\n\r\n\t\treturn this.hideOffline\r\n\t\t\t? entriesHere.filter(entry => this.data.isOnline(entry))\r\n\t\t\t: entriesHere\r\n\t}\r\n\r\n\tgetScores() {\r\n\t\tconst scoresHere = this.data.scores.filter(row => this.rows.has(row[1]))\r\n\r\n\t\treturn this.hideOffline\r\n\t\t\t? scoresHere.filter(row => this.data.isOnline(row[1]))\r\n\t\t\t: scoresHere\r\n\t}\r\n\r\n\tupdatePagination() {\r\n\t\tthis.pagination.update(this.getEntries().length)\r\n\t}\r\n\r\n\tappendEntry(entry: string) {\r\n\t\tlet tr = document.createElement(\"tr\")\r\n\t\ttr.setAttribute(\"entry\", Display.quoteEscape(entry))\r\n\r\n\t\t// Append skin image\r\n\t\tif (this.showSkins) {\r\n\t\t\tlet img = Display.appendElement(tr, \"td\")\r\n\t\t\tDisplay.appendImg(img, \"\")\r\n\t\t\timg.classList.add(\"sticky\", \"skin\")\r\n\t\t\timg.setAttribute(\"title\", entry)\r\n\t\t}\r\n\r\n\t\t// Append player name\r\n\t\tlet name = Display.appendTextElement(tr, \"td\", this.transformEntryName(entry))\r\n\t\tname.setAttribute(\"objective\", \"Player\")\r\n\t\tname.setAttribute(\"value\", entry)\r\n\r\n\t\t// Prepend online/afk status\r\n\t\tlet status = Display.prependElement(name, \"div\")\r\n\t\tstatus.classList.add(\"status\")\r\n\r\n\t\t// Highlight current player\r\n\t\tif (this.data.isCurrentPlayer(entry)) tr.classList.add(\"current-player\")\r\n\r\n\t\t// Append empty elements for alignment\r\n\t\tfor (const column of this.columns ?? this.data.columns) {\r\n\t\t\tlet td = Display.appendElement(tr, \"td\")\r\n\t\t\ttd.classList.add(\"empty\")\r\n\t\t\ttd.setAttribute(\"objective\", Display.quoteEscape(column))\r\n\t\t}\r\n\t\tthis.rows.set(entry, tr)\r\n\t}\r\n\r\n\tsetSkin(entry: string, row: HTMLTableRowElement) {\r\n\t\tconst img = row.getElementsByTagName(\"img\")[0]\r\n\t\tif (img) {\r\n\t\t\tif (entry == \"#server\") img.src = Display.CONSOLE_IMAGE\r\n\t\t\telse img.src = `https://www.mc-heads.net/avatar/${entry}.png`\r\n\t\t}\r\n\t}\r\n\r\n\tupdateScoreboard() {\r\n\t\tfor (const row of this.data.scores) {\r\n\t\t\tfor (const column of this.columns ?? this.data.columns) {\r\n\t\t\t\tlet value = row[this.data.columns_[column]] as string\r\n\t\t\t\tif (!value) continue\r\n\t\t\t\tconst td = this.rows.get(row[1]).querySelector(`td[objective='${column}']`) as HTMLTableCellElement\r\n\t\t\t\ttd.classList.remove(\"empty\")\r\n\t\t\t\ttd.setAttribute(\"value\", value)\r\n\r\n\t\t\t\t// Convert numbers to locale\r\n\t\t\t\tvalue = isNaN(value as any) ? value : Number(value).toLocaleString()\r\n\r\n\t\t\t\t// Convert Minecraft formatting codes\r\n\t\t\t\ttd.innerHTML = \"\"\r\n\t\t\t\ttd.append(...FormattingCodes.convertFormattingCodes(value))\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tupdateScoreboardAndShow() {\r\n\t\tthis.updateScoreboard()\r\n\t\tthis.show()\r\n\t}\r\n\r\n\tupdateOnlineStatus() {\r\n\t\tfor (const [_, row] of this.rows) {\r\n\t\t\tconst statusElement = row.querySelector(\"td .status\")\r\n\t\t\tif (!statusElement) continue\r\n\t\t\tconst entry = row.getAttribute(\"entry\")\r\n\t\t\trow.classList.remove(\"online\", \"afk\", \"offline\")\r\n\t\t\tstatusElement.classList.remove(\"online\", \"afk\", \"offline\")\r\n\r\n\t\t\tconst status = this.data.getStatus(entry)\r\n\t\t\trow.classList.add(status.toLowerCase())\r\n\t\t\tstatusElement.classList.add(status.toLowerCase())\r\n\t\t\tstatusElement.setAttribute(\"title\", this.data.getStatus(entry))\r\n\t\t}\r\n\t}\r\n\r\n\tupdateOnlineStatusAndShow() {\r\n\t\tthis.updateOnlineStatus()\r\n\t\tif (this.pagination && this.hideOffline) this.show()\r\n\t}\r\n\r\n\tupdateStats() {\r\n\t\tthis.updateScoreboard()\r\n\t\tthis.updateOnlineStatus()\r\n\t}\r\n\r\n\tupdateStatsAndShow() {\r\n\t\tthis.updateScoreboard()\r\n\t\tthis.updateOnlineStatus()\r\n\t\tthis.show()\r\n\t}\r\n\r\n\tchangeHideOffline(hideOffline: boolean) {\r\n\t\tthis.hideOffline = hideOffline\r\n\t\tif (this.pagination) {\r\n\t\t\tthis.pagination.changePage(1)\r\n\t\t\tthis.show()\r\n\t\t}\r\n\t}\r\n\r\n\t// Re-display table contents\r\n\tshow() {\r\n\t\tthis.data.sort(this.sortColumn, this.descending)\r\n\t\tthis.table.innerHTML = \"\"\r\n\t\tthis.table.append(this.headerElem)\r\n\t\tconst scores = this.getScores()\r\n\t\tconst [min, max] = this.pagination\r\n\t\t\t? this.pagination.getRange(scores.length)\r\n\t\t\t: [0, scores.length]\r\n\t\tfor (let i = min; i < max; i++) {\r\n\t\t\tif (this.showSkins) this.setSkin(scores[i][1], this.rows.get(scores[i][1]))\r\n\t\t\tthis.table.append(this.rows.get(scores[i][1]))\r\n\t\t}\r\n\t}\r\n\r\n\t// When a table header is clicked, sort by that header\r\n\tthClick(e: Event) {\r\n\t\tlet objective = (e.target as HTMLTableCellElement).innerText\r\n\t\tthis.descending = (objective === this.sortColumn) ? !this.descending : true\r\n\t\tthis.sortColumn = objective\r\n\t\tif (this.pagination) this.pagination.changePage(1)\r\n\t\tthis.show()\r\n\t}\r\n\t\r\n\t// Transform an entry name into the name to be displayed\r\n\ttransformEntryName = (entry: string) => {\r\n\t\tif (entry == \"#server\") return \"Server\"\r\n\t\telse if (this.data.isBedrockPlayer(entry)) return Data.transformBedrockPlayername(entry)\r\n\t\telse return entry\r\n\t}\r\n\r\n\t// Replace single quotes by '&quot;' (html-escape)\r\n\tstatic quoteEscape = (string: string) => string.replace(/'/g, \"&quot;\")\r\n\r\n\tstatic appendElement<K extends keyof HTMLElementTagNameMap>(base: HTMLElement, type: K) {\r\n\t\tlet el = document.createElement(type)\r\n\t\tbase.append(el)\r\n\t\treturn el\r\n\t}\r\n\r\n\tstatic prependElement<K extends keyof HTMLElementTagNameMap>(base: HTMLElement, type: K) {\r\n\t\tlet el = document.createElement(type)\r\n\t\tdocument.createElement\r\n\t\tbase.prepend(el)\r\n\t\treturn el\r\n\t}\r\n\r\n\tstatic appendTextElement<K extends keyof HTMLElementTagNameMap>(base: HTMLElement, type: K, name: string) {\r\n\t\tlet el = Display.appendElement(base, type)\r\n\t\tel.innerText = name\r\n\t\treturn el\r\n\t}\r\n\r\n\tstatic appendTh(base: HTMLElement, name: string, onclick: (this, ev) => any, colspan?: number) {\r\n\t\tlet th = Display.appendTextElement(base, \"th\", name)\r\n\t\tth.onclick = onclick\r\n\t\tif (colspan != undefined) th.setAttribute(\"colspan\", String(colspan))\r\n\t\treturn th\r\n\t}\r\n\r\n\tstatic appendImg(base: HTMLElement, src: string) {\r\n\t\tlet img = Display.appendElement(base, \"img\")\r\n\t\timg.src = src\r\n\t\treturn img\r\n\t}\r\n\r\n}\r\n","export default class Pagination {\r\n\tmaxPage: number\r\n\tdisplayCount: number\r\n\tcurrentPage: number\r\n\r\n\tparentElem: HTMLElement\r\n\tselectElem: HTMLSelectElement\r\n\tprevButton: HTMLButtonElement\r\n\tnextButton: HTMLButtonElement\r\n\r\n\tonPageChange: (page: number) => void\r\n\r\n\tconstructor(displayCount: number, elem: HTMLElement) {\r\n\t\tthis.displayCount = displayCount\r\n\t\tthis.currentPage = 1\r\n\t\t\r\n\t\tthis.parentElem = elem\r\n\t\tthis.selectElem = elem.querySelector(\"select.webstats-pagination[name=page]\")\r\n\t\tthis.prevButton = elem.querySelector(\"button.webstats-pagination[name=prev]\")\r\n\t\tthis.nextButton = elem.querySelector(\"button.webstats-pagination[name=next]\")\r\n\r\n\t\tthis.selectElem.addEventListener(\"change\",\r\n\t\t\t(e) => this.changePageAndCallback(Number((e.target as HTMLSelectElement).value)))\r\n\t\tthis.prevButton.addEventListener(\"click\",\r\n\t\t\t() => this.changePageAndCallback(this.currentPage - 1))\r\n\t\tthis.nextButton.addEventListener(\"click\",\r\n\t\t\t() => this.changePageAndCallback(this.currentPage + 1))\r\n\t}\r\n\r\n\tstatic create(displayCount: number, elem: HTMLElement) {\r\n\t\tconst prevButton = elem.appendChild(document.createElement(\"button\"))\r\n\t\tprevButton.classList.add(\"webstats-pagination\")\r\n\t\tprevButton.name = \"prev\"\r\n\t\tprevButton.innerText = \"Prev\"\r\n\r\n\t\tconst pageSelect = elem.appendChild(document.createElement(\"select\"))\r\n\t\tpageSelect.classList.add(\"webstats-pagination\")\r\n\t\tpageSelect.name = \"page\"\r\n\r\n\t\tconst nextButton = elem.appendChild(document.createElement(\"button\"))\r\n\t\tnextButton.classList.add(\"webstats-pagination\")\r\n\t\tnextButton.name = \"next\"\r\n\t\tnextButton.innerText = \"Next\"\r\n\r\n\t\treturn new Pagination(displayCount, elem)\r\n\t}\r\n\r\n\tupdate(nEntries: number) {\r\n\t\tthis.maxPage = Math.ceil(nEntries / this.displayCount)\r\n\t\t\r\n\t\t// Hide all controls when there is only one page\r\n\t\tif (this.maxPage == 1) {\r\n\t\t\tthis.parentElem.classList.add(\"pagination-hidden\")\r\n\t\t} else {\r\n\t\t\tthis.parentElem.classList.remove(\"pagination-hidden\")\r\n\t\t}\r\n\r\n\t\t// Page selector\r\n\t\tif (this.selectElem) {\r\n\t\t\tthis.selectElem.innerHTML = \"\"\r\n\t\t\tfor (let i = 1; i <= this.maxPage; i++) {\r\n\t\t\t\tconst optionElem = document.createElement(\"option\")\r\n\t\t\t\toptionElem.innerText = String(i)\r\n\t\t\t\tthis.selectElem.append(optionElem)\r\n\t\t\t}\r\n\t\t\tthis.selectElem.value = String(this.currentPage)\r\n\t\t}\r\n\r\n\t\t// \"Prev\" button\r\n\t\tif (this.prevButton) this.prevButton.toggleAttribute(\"disabled\", this.currentPage <= 1)\r\n\r\n\t\t// \"Next\" button\r\n\t\tif (this.nextButton) this.nextButton.toggleAttribute(\"disabled\", this.currentPage >= this.maxPage)\r\n\t}\r\n\r\n\tchangePage(page: number) {\r\n\t\tpage = Math.max(1, Math.min(page, this.maxPage))\r\n\t\tthis.currentPage = page\r\n\t}\r\n\r\n\tchangePageAndCallback(page: number) {\r\n\t\tthis.changePage(page)\r\n\t\tconsole.log(\"callback\")\r\n\t\tif (this.onPageChange) this.onPageChange(this.currentPage)\r\n\t}\r\n\r\n\tgetRange(nEntries?: number): [number, number] {\r\n\t\tconst min = (this.currentPage - 1) * this.displayCount\r\n\t\tconst max = (this.displayCount > 0)\r\n\t\t\t? Math.min(this.currentPage * this.displayCount, nEntries)\r\n\t\t\t: nEntries\r\n\t\treturn [min, max]\r\n\t}\r\n\r\n}\r\n","import Connection from \"./Connection\"\r\nimport Data from \"./Data\"\r\nimport Display from \"./Display\"\r\nimport Pagination from \"./Pagination\"\r\n\r\ndeclare global {\r\n\tinterface Window { webstats: WebStats }\r\n}\r\n\r\nexport type Direction = \"ascending\" | \"descending\"\r\n\r\nexport type TableConfig = {\r\n\tname?: string\r\n\tcolumns?: string[]\r\n\tsortColumn?: string\r\n\tsortDirection?: Direction\r\n}\r\n\r\nexport default class WebStats {\r\n\tstatic CONNECTION_ERROR_MSG = \"No connection to server. Either the server is offline, or the 'host' setting in index.html is incorrect.\"\r\n\r\n\tdisplays: Display[]\r\n\tconnection: Connection\r\n\tdata: Data\r\n\tupdateInterval: number\r\n\tinterval: number\r\n\r\n\tloadingElem?: HTMLElement\r\n\terrorElem?: HTMLElement\r\n\r\n\tconstructor(config) {\r\n\t\tthis.displays = []\r\n\t\tthis.connection = config.connection ?? Connection.json(config.host)\r\n\t\tthis.updateInterval = config.updateInterval ?? 10000\r\n\r\n\t\t// Status HTML elements\r\n\t\tconst statusElem = document.querySelector(\".webstats-status\")\r\n\t\tthis.loadingElem = statusElem?.querySelector(\".webstats-loading-indicator\")\r\n\t\tthis.errorElem = statusElem?.querySelector(\".webstats-error-message\")\r\n\t\tthis.setLoadingStatus(true)\r\n\r\n\t\t// Get data and init\r\n\t\tconst statsPromise = this.connection.getStats()\r\n\t\t\t.catch(this.catchError(WebStats.CONNECTION_ERROR_MSG, config))\r\n\t\tconst tableConfigsPromise = this.connection.getTables()\r\n\t\t\t.catch(this.catchError(WebStats.CONNECTION_ERROR_MSG, config))\r\n\t\tPromise.all([statsPromise, tableConfigsPromise])\r\n\t\t\t.then(([stats, tableConfigs]) => this.init(stats, tableConfigs, config))\r\n\t\t\t.catch(this.catchError(undefined, config))\r\n\r\n\t\t// Get saved toggles from cookies\r\n\t\tconst cookies = document.cookie.split(\"; \") ?? []\r\n\t\tcookies.filter(str => str.length > 0).forEach(cookie => {\r\n\t\t\tconst [property, value] = cookie.match(/[^=]+/g)\r\n\t\t\tdocument.documentElement.classList.toggle(property, value == \"true\")\r\n\t\t\tconst el = document.querySelector(\"input.webstats-option#\" + property) as HTMLInputElement\r\n\t\t\tif (el) el.checked = (value == \"true\")\r\n\t\t})\r\n\r\n\t\t// On config option toggle, set the html element's class and store cookie\r\n\t\tdocument.querySelectorAll(\"input.webstats-option\").forEach(el =>\r\n\t\t\tel.addEventListener(\"change\", () => {\r\n\t\t\t\tdocument.documentElement.classList.toggle(el.id, (el as HTMLInputElement).checked)\r\n\t\t\t\t// Set a cookie which expires in 10 years\r\n\t\t\t\tdocument.cookie = `${el.id}=${(el as HTMLInputElement).checked}; max-age=${60 * 60 * 24 * 365 * 10}; SameSite=Lax`\r\n\t\t\t})\r\n\t\t)\r\n\r\n\t\tconst optionHideOffline = document.querySelector(\"input.webstats-option#hide-offline\") as HTMLInputElement\r\n\t\tif (optionHideOffline) {\r\n\t\t\t// Re-show if displayCount is set\r\n\t\t\toptionHideOffline.addEventListener(\"change\", (e) => {\r\n\t\t\t\tthis.displays.forEach(display => display.changeHideOffline(optionHideOffline.checked))\r\n\t\t\t})\r\n\t\t\tthis.displays.forEach(display => display.changeHideOffline(optionHideOffline.checked))\r\n\t\t}\r\n\r\n\t\twindow.webstats = this\r\n\t}\r\n\r\n\tinit(data, tableConfigs: TableConfig[] | undefined, config) {\r\n\t\tif (config.tables) {\r\n\t\t\tfor (const tableName in config.tables) {\r\n\t\t\t\tconst tableConfig = tableConfigs\r\n\t\t\t\t\t? tableConfigs.find(tc => (tc.name ?? \"\") == tableName)\r\n\t\t\t\t\t: { colums: data.scoreboard.columns as string[] } as TableConfig\r\n\t\t\t\tif (tableConfig) this.addTableManual(config, tableConfig)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (tableConfigs) {\r\n\t\t\t\tfor (const tableConfig of tableConfigs) {\r\n\t\t\t\t\tthis.addTableAutomatic(config, tableConfig)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.addTableAutomatic(config, { colums: data.scoreboard.columns as string[] } as TableConfig)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.data = new Data(data)\r\n\t\tthis.displays.forEach(display => {\r\n\t\t\tdisplay.init(this.data)\r\n\t\t\tdisplay.show()\r\n\t\t})\r\n\r\n\t\t// Set update interval\r\n\t\tif (this.updateInterval > 0) {\r\n\t\t\tthis.startUpdateInterval(true)\r\n\t\t\tdocument.addEventListener(\"visibilitychange\", () => document.hidden\r\n\t\t\t\t? this.stopUpdateInterval() : this.startUpdateInterval())\r\n\t\t}\r\n\r\n\t\tthis.setLoadingStatus(false)\r\n\t}\r\n\r\n\tupdate() {\r\n\t\t// When nobody is online, assume scoreboard does not change\r\n\t\tif (this.data.nOnline > 0) {\r\n\t\t\tthis.connection.getStats().then(data => {\r\n\t\t\t\tthis.data.setStats(data)\r\n\t\t\t\tthis.displays.forEach(display => display.updateStatsAndShow())\r\n\t\t\t}).catch(this.catchError(WebStats.CONNECTION_ERROR_MSG))\r\n\t\t} else {\r\n\t\t\tthis.connection.getOnline().then(data => {\r\n\t\t\t\tthis.data.setOnlineStatus(data)\r\n\t\t\t\tthis.displays.forEach(display => display.updateOnlineStatusAndShow())\r\n\t\t\t}).catch(this.catchError(WebStats.CONNECTION_ERROR_MSG))\r\n\t\t}\r\n\t}\r\n\r\n\tstartUpdateInterval(first?: boolean) {\r\n\t\tthis.interval = setInterval(this.update.bind(this) as TimerHandler, this.updateInterval)\r\n\t\tif (!first) this.update()\r\n\t}\r\n\r\n\tstopUpdateInterval() {\r\n\t\tclearInterval(this.interval)\r\n\t}\r\n\r\n\taddTableManual(config, tableConfig: TableConfig) {\r\n\t\tlet pagination: Pagination\r\n\t\tif (config.displayCount > 0 && config.tables[tableConfig.name ?? \"\"].pagination) {\r\n\t\t\tconst paginationParent = config.tables[tableConfig.name ?? \"\"].pagination\r\n\t\t\tpagination = new Pagination(config.displayCount, paginationParent)\r\n\t\t}\r\n\t\tthis.displays.push(new Display(\r\n\t\t\t{ ...config, table: config.tables[tableConfig.name ?? \"\"].table, pagination: pagination },\r\n\t\t\ttableConfig\r\n\t\t))\r\n\t}\r\n\r\n\taddTableAutomatic(config, tableConfig: TableConfig) {\r\n\t\tconst headerElem = (config.tableParent as HTMLElement)\r\n\t\t\t.appendChild(document.createElement(\"div\"))\r\n\t\theaderElem.classList.add(\"webstats-tableheading\")\r\n\t\tif (tableConfig.name) {\r\n\t\t\theaderElem.innerText = tableConfig.name\r\n\t\t\theaderElem.setAttribute(\"webstats-table\", tableConfig.name)\r\n\t\t}\r\n\r\n\t\tlet pagination: Pagination\r\n\t\tif (config.displayCount > 0) {\r\n\t\t\tconst paginationControls = headerElem.appendChild(document.createElement(\"span\"))\r\n\t\t\tpaginationControls.classList.add(\"webstats-pagination\")\r\n\t\t\tpagination = Pagination.create(config.displayCount, paginationControls)\r\n\t\t}\r\n\r\n\t\tconst tableElem = (config.tableParent as HTMLElement)\r\n\t\t\t.appendChild(document.createElement(\"table\"))\r\n\t\tif (tableConfig.name) tableElem.setAttribute(\"webstats-table\", tableConfig.name)\r\n\t\tthis.displays.push(new Display(\r\n\t\t\t{ ...config, table: tableElem, pagination: pagination },\r\n\t\t\ttableConfig\r\n\t\t))\r\n\t}\r\n\r\n\tsetLoadingStatus(loading) {\r\n\t\tif (!this.loadingElem) return\r\n\t\tthis.loadingElem.style.display = loading ? \"inline\" : \"none\"\r\n\t}\r\n\r\n\tsetErrorMessage(msg: string, config?) {\r\n\t\tif (this.errorElem) this.errorElem.innerText = msg\r\n\t\telse {\r\n\t\t\tconst spanElem = document.createElement(\"span\")\r\n\t\t\tspanElem.innerText = msg\r\n\t\t\tspanElem.classList.add(\"webstats-error-message\")\r\n\t\t\tif (config?.tableParent) {\r\n\t\t\t\tconfig.tableParent.appendChild(spanElem)\r\n\t\t\t} else if (config?.tables) {\r\n\t\t\t\tfor (const tablename in config.tables) {\r\n\t\t\t\t\tif (config.tables[tablename].table) config.tables[tablename].table.appendChild(spanElem)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcatchError(msg?: string, config?) {\r\n\t\tconst self = this\r\n\t\treturn e => {\r\n\t\t\tconsole.error(e)\r\n\t\t\tif (msg) console.warn(msg)\r\n\t\t\tself.setErrorMessage(msg ?? e, config)\r\n\t\t\tself.setLoadingStatus(false)\r\n\t\t\tself.stopUpdateInterval()\r\n\t\t}\r\n\t}\r\n\r\n}\r\n"],"names":["Connection","all","scores","online","tables","constructor","this","static","host","getStats","async","fetch","json","scoreboard","Promise","getOnline","getScoreboard","then","response","catch","getTables","Data","columns","players","columns_","playernames","bedrockPrefix","data","setStats","entries","nOnline","Object","keys","length","isOnline","player","isAFK","isOffline","getStatus","isCurrentPlayer","includes","setScoreboard","sort","filter","entryName","entry","push","columnName","Player","forEach","val","idx","setOnlineStatus","setPlayernames","isPlayerOrServer","bind","isNonemptyEntry","Intl","Collator","compare","isNonemptyObjective","by","descending","collator","undefined","sensitivity","a_row","b_row","a","b","isNaN","Number","_","score","match","isBedrockPlayer","startsWith","objective","substring","replaceAll","obj","predicate","fromEntries","v","mapper","map","k","FormattingCodes","value","parseFormattingCodes","convertFormattingCode","part","format","colour","text","span","document","createElement","innerText","classList","add","colourType","style","color","parts","firstIdx","matchAll","FORMATTING_CODE_REGEX","next","index","parseFormattingCode","code","prev","COLOUR_CODES","FORMATTING_CODES","matches","slice","join","Display","table","pagination","sortColumn","showSkins","hideOffline","headerElem","rows","sortDirection","onPageChange","page","updatePagination","show","init","append","appendTh","thClick","column","Map","getEntries","appendEntry","updateStatsAndShow","entriesHere","some","getScores","scoresHere","row","has","update","tr","setAttribute","quoteEscape","img","appendElement","appendImg","name","appendTextElement","transformEntryName","prependElement","td","set","setSkin","getElementsByTagName","src","CONSOLE_IMAGE","updateScoreboard","get","querySelector","remove","toLocaleString","innerHTML","convertFormattingCodes","updateScoreboardAndShow","updateOnlineStatus","statusElement","getAttribute","status","toLowerCase","updateOnlineStatusAndShow","updateStats","changeHideOffline","changePage","min","max","getRange","i","e","target","transformBedrockPlayername","string","replace","base","type","el","prepend","onclick","colspan","th","String","Pagination","maxPage","displayCount","currentPage","parentElem","selectElem","prevButton","nextButton","elem","addEventListener","changePageAndCallback","appendChild","pageSelect","nEntries","Math","ceil","optionElem","toggleAttribute","console","log","WebStats","displays","connection","updateInterval","interval","loadingElem","errorElem","config","statusElem","setLoadingStatus","statsPromise","catchError","CONNECTION_ERROR_MSG","tableConfigsPromise","stats","tableConfigs","cookie","split","str","property","documentElement","toggle","checked","querySelectorAll","id","optionHideOffline","display","window","webstats","tableName","tableConfig","find","tc","colums","addTableManual","addTableAutomatic","startUpdateInterval","hidden","stopUpdateInterval","first","setInterval","clearInterval","paginationParent","tableParent","paginationControls","create","tableElem","loading","setErrorMessage","msg","spanElem","tablename","self","error","warn"],"mappings":"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"}