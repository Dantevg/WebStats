/*!
	WebStats version 1.10
	https://github.com/Dantevg/WebStats
	
	by RedPolygon
	
	Licence: MIT
	
	Includes modified version of @itsjavi/jsx-runtime
		(MIT licenced, https://github.com/itsjavi/jsx-runtime/)
*/
class t{all;scores;online;tables;serverIcon;constructor({all:t,scores:e,online:s,tables:n,serverIcon:i}){this.all=t,this.scores=e,this.online=s,this.tables=n,this.serverIcon=i}static json(e){const s=e.startsWith("http")?"":"http://";return new t({all:`${s}${e}/stats.json`,scores:`${s}${e}/scoreboard.json`,online:`${s}${e}/online.json`,tables:`${s}${e}/tables.json`,serverIcon:`${s}${e}/server-icon.png`})}getStats=async()=>{if(this.all)return await(await fetch(this.all)).json();{const[t,e]=await Promise.all([this.getOnline(),this.getScoreboard()]);return{online:t,scoreboard:e}}};getScoreboard=()=>fetch(this.scores).then((t=>t.json())).catch((()=>{}));getOnline=()=>fetch(this.online).then((t=>t.json())).catch((()=>{}));getTables=()=>fetch(this.tables).then((t=>t.json())).catch((()=>{}))}class e{static BEDROCK_PREFIX=".";scoreboard;columns;scores;players;columns_;units;skins;playernames;constructor(t){this.setStats(t)}get entries(){return this.scoreboard.entries}get online(){return this.players}get nOnline(){return Object.keys(this.players).length}isOnline=t=>!0===this.players[t]||"#server"==t;isAFK=t=>"afk"===this.players[t];isOffline=t=>!!this.players[t];getStatus=t=>this.isOnline(t)?"online":this.isAFK(t)?"afk":"offline";isCurrentPlayer=t=>this.playernames?.includes(t)??!1;setScoreboard(t){this.scoreboard=t,this.columns=Object.keys(t.scores).sort(),this.filter(),this.scores=[];for(const t of this.entries){const e=[];e.push(this.scores.push(e)-1),e.push(t);for(const s of this.columns)e.push(this.scoreboard.scores[s]?.[t]??"")}this.columns_={Player:1},this.columns.forEach(((t,e)=>this.columns_[t]=e+2))}setOnlineStatus(t){this.players=t}setPlayernames(t){this.playernames=t}setUnits(t){this.units=t}setSkins(t){this.skins=t}setStats(t){this.setScoreboard(t.scoreboard),this.setOnlineStatus(t.online),this.setPlayernames(t.playernames),this.setUnits(t.units??{}),this.setSkins(t.skins??{})}filter(){this.scoreboard.entries=this.scoreboard.entries.filter(e.isPlayerOrServer).filter(this.isNonemptyEntry.bind(this)).sort(Intl.Collator().compare),this.scoreboard.scores=e.filter(this.scoreboard.scores,e.isNonemptyObjective)}sort(t,e){const s=new Intl.Collator(void 0,{sensitivity:"base",numeric:!0});this.scores=this.scores.sort(((n,i)=>(e?-1:1)*s.compare(n[this.columns_[t]],i[this.columns_[t]])))}isNonemptyEntry=t=>Object.entries(this.scoreboard.scores).filter((([e,s])=>s[t]&&"0"!=s[t])).length>0;static isPlayerOrServer=t=>"#server"==t||t.match(/^\w{3,16}$/)&&!t.match(/^\d*$/)||e.isBedrockPlayer(t);static isBedrockPlayer=t=>t.startsWith(e.BEDROCK_PREFIX);static isNonemptyObjective=t=>Object.keys(t).filter(e.isPlayerOrServer).length>0;static transformBedrockPlayername=t=>t.substring(1).replaceAll("_"," ");static filter=(t,e)=>Object.fromEntries(Object.entries(t).filter((([t,s])=>e(s))));static map=(t,e)=>Object.fromEntries(Object.entries(t).map((([t,s])=>[t,e(t,s)])))}function s(){return(s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t}).apply(this,arguments)}const n=["children"],i="jsx.Fragment";function a(t,e){if("function"==typeof t)return void 0!==t.prototype?new t(e):t(e);const{children:i=[]}=e;return{type:t,key:null,props:s({},function(t,e){if(null==t)return{};var s,n,i={},a=Object.keys(t);for(n=0;n<a.length;n++)e.indexOf(s=a[n])>=0||(i[s]=t[s]);return i}(e,n),{children:Array().concat(i).map((t=>"object"==typeof t?t:{type:"jsx.Text",key:null,props:{text:t,children:[]}}))})}}a.Fragment="jsx.Fragment",a.TextNode="jsx.Text",a.customAttributes=["children","key","props"];const r=t=>!a.customAttributes.includes(t);class o{constructor(t){this.element=null,this.props=void 0,this.props=t}render(){return null}}"undefined"!=typeof window&&(a._globalThis=window),a.setGlobalThis=t=>{a._globalThis=t},a.renderDOM=(t,e=null,s=null,n=!1)=>{const i=t instanceof o;let l=i?t.render():t;i&&(s=t);const c=null===e?a._globalThis.document:e.ownerDocument;if(l.type===a.TextNode){void 0===l.props.text&&(l.props.text="");const t=c.createTextNode(l.props.text);return null!==e&&e.appendChild(t),t}const h=l.type===a.Fragment?c.createDocumentFragment():c.createElement(l.type);h.jsxComponent=s;const u=l.props,d=Object.keys(u);void 0!==u.className&&Array.isArray(u.className)&&(u.className=u.className.join(" ")),d.filter(r).forEach((t=>{let e=u[t];null!==s&&e instanceof Function&&(e=e.bind(s),e instanceof Function&&e(null)),t.startsWith("data-")&&h.setAttribute(t,e),h[t]=e,h[t.toLowerCase()]=e})),Array.isArray(l.props.children)&&l.props.children.forEach((t=>a.renderDOM(t,h,s)));let m=null;return i&&null!==s&&(m=s.element,s.element=h),i&&null!==s&&void 0!==s.onWillMount&&s.onWillMount(m),null!==e&&(n?e.replaceChildren(h):e.appendChild(h)),i&&null!==s&&void 0!==s.onDidMount&&s.onDidMount(m),h};const l=(t,e=null,s=null)=>a.renderDOM(t,e,s,!0),c={"§0":"black","§1":"dark_blue","§2":"dark_green","§3":"dark_aqua","§4":"dark_red","§5":"dark_purple","§6":"gold","§7":"gray","§8":"dark_gray","§9":"blue","§a":"green","§b":"aqua","§c":"red","§d":"light_purple","§e":"yellow","§f":"white"},h={"§k":"obfuscated","§l":"bold","§m":"strikethrough","§n":"underline","§o":"italic","§r":"reset"},u=/(§x§.§.§.§.§.§.|§.)([^§]*)/gm;function d(t){if(!t.format&&!t.colour)return t.text;if(0==t.text.length)return t.text;const e=["mc-format"];return t.format&&e.push(`mc-${t.format}`),"simple"==t.colourType&&e.push(`mc-${t.colour}`),a("span",{className:e,style:"hex"==t.colourType&&`color: ${t.colour}`,children:t.text})}function m(t,e,s){if(c[t])return{text:e,colour:c[t],colourType:"simple"};if(h[t])return"reset"==h[t]?{text:e}:{text:e,format:h[t],colour:s?.colour,colourType:s?.colourType};const n=t.match(/§x§(.)§(.)§(.)§(.)§(.)§(.)/m);return n?{text:e,colour:"#"+n.slice(1).join(""),colourType:"hex"}:{text:e}}const p=t=>function(t){const e=[],s=t.matchAll(u).next().value?.index;(null==s||s>0)&&e.push({text:t.substring(0,s)});for(const s of t.matchAll(u))e.push(m(s[1],s[2],e[e.length-1]));return e}(t).map(d),g=["ticks","milliseconds","ms","seconds","s","minutes","min","hours","h","days","d"],b=["blocks","millimetres","millimeters","mm","centimetres","centimeters","cm","metres","meters","m","kilometres","kilometers","km"],f=["timestamp","formatted date"],y=["items","items16"],v={milliseconds:.001,ms:.001,ticks:.05,seconds:1,s:1,minutes:60,min:60,hours:3600,h:3600,days:86400,d:86400,millimetres:.001,millimeters:.001,mm:.001,centimetres:.01,centimeters:.01,cm:.01,blocks:1,metres:1,meters:1,m:1,kilometres:1e3,kilometers:1e3,km:1e3,items:1,items16:1};function w(t,e){return g.includes(e)?function(t,e){if(0==t)return"0";const s=t*v[e],n=new Date(1e3*s),i=Math.floor(s/v.days),a=n.getUTCHours(),r=n.getUTCMinutes(),o=n.getUTCSeconds()+n.getUTCMilliseconds()/1e3;return a>0||i>0?`${a+24*i}:${String(r).padStart(2,"0")} h`:r>0?`${r}:${String(Math.floor(o)).padStart(2,"0")}`:`${o} s`}(Number(t),e):b.includes(e)?function(t,e){if(0==t)return"0";const s=t*v[e];return s<v.cm?Math.floor(s/v.mm)+" mm":s<v.m?Math.floor(s/v.cm)+" cm":s<v.km?Math.floor(s)+" m":Math.floor(s/v.km)+" km"}(Number(t),e):f.includes(e)?function(t,e){return("timestamp"==e?new Date(Number(t)):new Date(t)).toLocaleString()}(t,e):y.includes(e)?function(t,e){if(0==t)return"0";const s=t,n="items16"==e?16:64,i=Math.floor(s/n),a=s%n;return i>0?a>0?`${i} st ${a}`:`${i} st`:String(a)}(Number(t),e):isNaN(t)?t:Number(t).toLocaleString()}const S=(t,e,s)=>e==t&&["webstats-sort-column",s?"descending":"ascending"],k=t=>{"Enter"==t.key&&t.target.click()},E=t=>"#server"==t?"Server":e.isBedrockPlayer(t)?e.transformBedrockPlayername(t):t,P=(t,e)=>null!=e&&e.startsWith("http")?e:null!=e?`https://www.mc-heads.net/avatar/${e}/64.png`:"#server"!=t?`https://www.mc-heads.net/avatar/${t}/64.png`:void 0,C=({columns:t,showSkins:e,sortColumn:s,sortDescending:n,onClick:i})=>a("tr",{children:[a("th",{colSpan:e&&2,onClick:i,onKeyDown:k,tabIndex:"0","data-objective":"Player",className:S("Player",s,n),children:"Player"}),...t.map((t=>a("th",{onClick:i,onKeyDown:k,tabIndex:"0","data-objective":t,className:S(t,s,n),children:t})))]}),x=({entry:t,skin:e})=>a("td",{className:["sticky","skin"],title:t,children:a("img",{title:t,src:P(t,e),alt:" "})}),O=({column:t,value:e,relative:s,unit:n})=>{if(null==e||"0"==e)return a("td",{"data-objective":t,className:"empty"});return a("td",{"data-objective":t,"data-value":e,"data-unit":n,title:n?`${e} ${n}`:e,style:s&&`--relative: ${s}%;`,children:p(w(e,n))})},N=({entry:t,status:e,name:s})=>a("td",{"data-objective":"Player","data-value":t,title:t,children:[a("div",{className:["status",e],title:e}),a(i,{children:s?p(s):E(t)})]});class j extends o{props;values=new Map;relative=new Map;status="offline";constructor(t){super(t),this.props=t}render=()=>a("tr",{entry:this.props.entry,className:[this.status,this.props.isCurrentPlayer?"current-player":void 0],children:[this.props.showSkins&&a(x,{entry:this.props.entry,skin:this.props.skin}),a(N,{entry:this.props.entry,status:this.status,name:this.values.get("Player")}),...this.props.columns.map((t=>a(O,{column:t,value:this.values.get(t),relative:this.relative.get(t),unit:this.props.units[t]})))]})}class T{table;pagination;columns;sortColumn;descending;showSkins;serverIconURL;hideOffline;data;rows;constructor({table:t,pagination:e,showSkins:s=!0,serverIconURL:n},{columns:i,sortColumn:a="Player",sortDirection:r="descending"}){this.table=t,this.pagination=e,this.columns=i,this.sortColumn=a,this.descending="descending"==r,this.showSkins=s,this.serverIconURL=n,this.hideOffline=!1,this.pagination&&(this.pagination.onPageChange=t=>this.show())}init(t){this.data=t,this.pagination&&this.updatePagination(),this.rows=new Map;for(const t of this.getEntries())this.rows.set(t,new j({columns:this.columns??this.data.columns,units:this.data.units,showSkins:this.showSkins,skin:"#server"==t?this.serverIconURL:this.data.skins[t],entry:t,isCurrentPlayer:this.data.isCurrentPlayer(t)}));this.updateStats()}getEntries(){const t=this.data.entries.filter((t=>(this.columns??this.data.columns).some((e=>this.data.scoreboard.scores[e]?.[t]&&"0"!=this.data.scoreboard.scores[e][t]))));return this.hideOffline?t.filter((t=>this.data.isOnline(t))):t}getScores(){const t=this.data.scores.filter((t=>this.rows.has(t[1])));return this.hideOffline?t.filter((t=>this.data.isOnline(t[1]))):t}updatePagination(){this.pagination.update(this.getEntries().length)}updateScoreboard(){for(const t of["Player"].concat(this.columns??this.data.columns)){if("Player"==t&&1==this.data.columns_.Player)continue;let e=0,s=!0;for(const n of this.data.scores){if(!this.rows.has(n[1]))continue;let i=n[this.data.columns_[t]];i&&(this.rows.get(n[1]).values.set(t,i),s&&!isNaN(Number(i))?e=Math.max(e,Number(i)):s=!1)}if(s)for(const s of this.data.scores)this.rows.has(s[1])&&this.rows.get(s[1]).relative.set(t,Number(s[this.data.columns_[t]])/e*100)}}updateScoreboardAndShow(){this.updateScoreboard(),this.show()}updateOnlineStatus(){for(const[t,e]of this.rows)e.status=this.data.getStatus(e.props.entry)}updateOnlineStatusAndShow(){this.updateOnlineStatus(),this.pagination&&this.show()}updateStats(){this.updateScoreboard(),this.updateOnlineStatus()}updateStatsAndShow(){this.updateStats(),this.show()}changeHideOffline(t){this.hideOffline=t,this.pagination&&(this.updatePagination(),this.pagination.changePage(1),this.show())}show(){this.data.sort(this.sortColumn,this.descending);const t=this.getScores(),[e,s]=this.pagination?this.pagination.getRange(t.length):[0,t.length],n=[];n.push(a(C,{columns:this.columns??this.data.columns,showSkins:this.showSkins,sortColumn:this.sortColumn,sortDescending:this.descending,onClick:this.thClick.bind(this)}));for(let i=e;i<s;i++)n.push(this.rows.get(t[i][1]));l(a(i,{children:n}),this.table)}thClick(t){const e=t.target.getAttribute("data-objective");this.descending=e!==this.sortColumn||!this.descending,this.sortColumn=e,this.pagination?.changePage(1),this.show();for(const t of this.table.getElementsByTagName("th"))if(t.innerText==e){t.focus();break}}static quoteEscape=t=>t.replace(/'/g,"&quot;")}class I{maxPage;displayCount;currentPage;parentElem;selectElem;prevButton;nextButton;onPageChange;constructor(t,e){this.displayCount=t,this.currentPage=1,this.parentElem=e,this.selectElem=e.querySelector("select.webstats-pagination[name=page]"),this.prevButton=e.querySelector("button.webstats-pagination[name=prev]"),this.nextButton=e.querySelector("button.webstats-pagination[name=next]"),this.selectElem.addEventListener("change",(t=>this.changePageAndCallback(Number(t.target.value)))),this.prevButton.addEventListener("click",(()=>this.changePageAndCallback(this.currentPage-1))),this.nextButton.addEventListener("click",(()=>this.changePageAndCallback(this.currentPage+1)))}static create(t,e){const s=a(i,{children:[a("button",{className:"webstats-pagination",name:"prev",children:"Prev"}),a("select",{className:"webstats-pagination",name:"page"}),a("button",{className:"webstats-pagination",name:"next",children:"Next"})]});return l(s,e),new I(t,e)}update(t){if(this.maxPage=Math.ceil(t/this.displayCount),1==this.maxPage?this.parentElem.classList.add("pagination-hidden"):this.parentElem.classList.remove("pagination-hidden"),this.selectElem){this.selectElem.innerHTML="";for(let t=1;t<=this.maxPage;t++){const e=document.createElement("option");e.innerText=String(t),this.selectElem.append(e)}this.selectElem.value=String(this.currentPage)}this.prevButton&&this.prevButton.toggleAttribute("disabled",this.currentPage<=1),this.nextButton&&this.nextButton.toggleAttribute("disabled",this.currentPage>=this.maxPage)}changePage(t){t=Math.max(1,Math.min(t,this.maxPage)),this.currentPage=t,this.selectElem.value=String(this.currentPage),this.prevButton&&this.prevButton.toggleAttribute("disabled",this.currentPage<=1),this.nextButton&&this.nextButton.toggleAttribute("disabled",this.currentPage>=this.maxPage)}changePageAndCallback(t){this.changePage(t),this.onPageChange&&this.onPageChange(this.currentPage)}getRange(t){return[(this.currentPage-1)*this.displayCount,this.displayCount>0?Math.min(this.currentPage*this.displayCount,t):t]}}class M{static CONNECTION_ERROR_MSG="No connection to server. Maybe the server is offline, or the 'host' setting in index.html is incorrect.";displays;connection;data;updateInterval;interval;loadingElem;errorElem;constructor(e){this.displays=[],this.connection=e.connection??t.json(e.host),this.updateInterval=e.updateInterval??1e4;const s=document.querySelector("input.webstats-option#hide-offline"),n=document.querySelector(".webstats-status");this.loadingElem=n?.querySelector(".webstats-loading-indicator"),this.errorElem=n?.querySelector(".webstats-error-message"),this.setLoadingStatus(!0);const i=this.connection.getStats(),a=this.connection.getTables();Promise.all([i,a]).then((([t,n])=>this.init(t,n,e,s.checked)),this.catchError(M.CONNECTION_ERROR_MSG,e)).catch(this.catchError(void 0,e));(document.cookie.split("; ")??[]).filter((t=>t.length>0)).forEach((t=>{const[e,s]=t.match(/[^=]+/g);document.documentElement.classList.toggle(e,"true"==s);const n=document.querySelector("input.webstats-option#"+e);n&&(n.checked="true"==s)})),document.querySelectorAll("input.webstats-option").forEach((t=>t.addEventListener("change",(()=>{document.documentElement.classList.toggle(t.id,t.checked),document.cookie=`${t.id}=${t.checked}; max-age=315360000; SameSite=Lax`})))),s?.addEventListener("change",(t=>{this.displays.forEach((t=>t.changeHideOffline(s.checked)))})),window.webstats=this}init(t,s,n,i){if(n.tables)for(const e in n.tables){const i=s?s.find((t=>(t.name??"")==e)):{colums:t.scoreboard.columns};i&&this.addTableManual(n,i)}else if(s)for(const t of s)this.addTableAutomatic(n,t);else this.addTableAutomatic(n,{colums:t.scoreboard.columns});this.data=new e(t),this.displays.forEach((t=>{t.init(this.data),t.hideOffline=i,t.show()})),this.updateInterval>0&&(this.startUpdateInterval(!0),document.addEventListener("visibilitychange",(()=>document.hidden?this.stopUpdateInterval():this.startUpdateInterval()))),this.setLoadingStatus(!1)}update(){this.data.nOnline>0?this.connection.getStats().then((t=>{this.data.setStats(t),this.displays.forEach((t=>t.updateStatsAndShow()))})).catch(this.catchError(M.CONNECTION_ERROR_MSG)):this.connection.getOnline().then((t=>{this.data.setOnlineStatus(t),this.displays.forEach((t=>t.updateOnlineStatusAndShow()))})).catch(this.catchError(M.CONNECTION_ERROR_MSG))}startUpdateInterval(t){this.interval=setInterval(this.update.bind(this),this.updateInterval),t||this.update()}stopUpdateInterval(){clearInterval(this.interval)}addTableManual(t,e){let s;if(t.displayCount>0&&t.tables[e.name??""].pagination){const n=t.tables[e.name??""].pagination;s=new I(t.displayCount,n)}this.displays.push(new T({...t,table:t.tables[e.name??""].table,pagination:s,serverIconURL:this.connection.serverIcon},e))}addTableAutomatic(t,e){const s=t.tableParent.appendChild(document.createElement("div"));let n;if(s.classList.add("webstats-tableheading"),e.name&&(s.innerText=e.name,s.setAttribute("webstats-table",e.name)),t.displayCount>0){const e=s.appendChild(document.createElement("span"));e.classList.add("webstats-pagination"),n=I.create(t.displayCount,e)}const i=t.tableParent.appendChild(document.createElement("table"));e.name&&i.setAttribute("webstats-table",e.name),this.displays.push(new T({...t,table:i,pagination:n,serverIconURL:this.connection.serverIcon},e))}setLoadingStatus(t){this.loadingElem&&(this.loadingElem.style.display=t?"inline":"none")}setErrorMessage(t,e){if(this.errorElem)this.errorElem.innerText=t;else{const s=document.createElement("span");if(s.innerText=t,s.classList.add("webstats-error-message"),e?.tableParent)e.tableParent.appendChild(s);else if(e?.tables)for(const t in e.tables)e.tables[t].table&&e.tables[t].table.appendChild(s)}}catchError(t,e){const s=this;return n=>{console.error(n),t&&console.warn(t),s.setErrorMessage(t??n,e),s.setLoadingStatus(!1),s.stopUpdateInterval()}}}export{t as Connection,e as Data,T as Display,I as Pagination,p as convertFormattingCodes,M as default};
//# sourceMappingURL=WebStats-dist.js.map
