{"version":3,"file":"WebStats-dist.js","sources":["src/Connection.ts","src/Data.ts","src/FormattingCodes.ts","src/Display.ts","src/Pagination.ts","src/WebStats.ts"],"sourcesContent":["export default class Connection {\r\n\tall: string\r\n\tscores: string\r\n\tonline: string\r\n\ttables: string\r\n\r\n\tconstructor({ all, scores, online, tables }) {\r\n\t\tthis.all = all\r\n\t\tthis.scores = scores\r\n\t\tthis.online = online\r\n\t\tthis.tables = tables\r\n\t}\r\n\r\n\tstatic json(host: string) {\r\n\t\treturn new Connection({\r\n\t\t\tall:  `http://${host}/stats.json`,\r\n\t\t\tscores:  `http://${host}/scoreboard.json`,\r\n\t\t\tonline:  `http://${host}/online.json`,\r\n\t\t\ttables:  `http://${host}/tables.json`,\r\n\t\t})\r\n\t}\r\n\r\n\tgetStats = async () => {\r\n\t\tif (this.all) {\r\n\t\t\treturn await (await fetch(this.all)).json()\r\n\t\t} else {\r\n\t\t\tconst [online, scoreboard] = await Promise.all([this.getOnline(), this.getScoreboard()])\r\n\t\t\treturn { online, scoreboard }\r\n\t\t}\r\n\t}\r\n\tgetScoreboard = () => fetch(this.scores).then(response => response.json()).catch(() => {})\r\n\tgetOnline = () => fetch(this.online).then(response => response.json()).catch(() => {})\r\n\tgetTables = () => fetch(this.tables).then(response => response.json()).catch(() => {})\r\n}\r\n","type Scoreboard = {\r\n\tentries: string[],\r\n\tscores: { [column: string]: { [entry: string]: string } },\r\n\tcolumns?: string[]\r\n}\r\ntype Online = { [player: string]: boolean | \"afk\" }\r\ntype Entry = [number, string, ...(string)[]]\r\n\r\nexport default class Data {\r\n\tscoreboard: Scoreboard\r\n\tcolumns: string[]\r\n\tscores: Entry[]\r\n\tplayers: Online\r\n\tcolumns_: { [column: string]: number }\r\n\tplayernames: string[]\r\n\r\n\tconstructor(data: { scoreboard: Scoreboard, online: Online, playernames: string[] }) {\r\n\t\tthis.setStats(data)\r\n\t}\r\n\r\n\tget entries() { return this.scoreboard.entries }\r\n\tget online() { return this.players }\r\n\tget nOnline() { return Object.keys(this.players).length }\r\n\r\n\tisOnline = (player: string) => this.players[player] === true\r\n\tisAFK = (player: string) => this.players[player] === \"afk\"\r\n\tisOffline = (player: string) => !!this.players[player]\r\n\tgetStatus = (player: string) => this.isOnline(player) ? \"online\"\r\n\t\t: (this.isAFK(player) ? \"AFK\" : \"offline\")\r\n\tisCurrentPlayer = (player: string) => this.playernames?.includes(player) ?? false\r\n\r\n\tsetScoreboard(scoreboard: Scoreboard) {\r\n\t\tthis.scoreboard = scoreboard\r\n\t\tthis.columns = Object.keys(scoreboard.scores).sort()\r\n\r\n\t\tthis.filter()\r\n\r\n\t\tthis.scores = []\r\n\t\tfor (const entryName of this.entries) {\r\n\t\t\tconst entry = []\r\n\t\t\tentry.push(this.scores.push(entry as Entry) - 1)\r\n\t\t\tentry.push(entryName)\r\n\t\t\tfor (const columnName of this.columns) {\r\n\t\t\t\tentry.push(this.scoreboard.scores[columnName]?.[entryName] ?? 0)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Reverse-map column names to indices\r\n\t\t// (index 0 contains the original index, before sorting)\r\n\t\tthis.columns_ = { Player: 1 }\r\n\t\tthis.columns.forEach((val, idx) => this.columns_[val] = idx + 2)\r\n\t}\r\n\tsetOnlineStatus(online: Online) { this.players = online }\r\n\tsetPlayernames(playernames: string[]) { this.playernames = playernames }\r\n\tsetStats(data: { scoreboard: Scoreboard, online: Online, playernames: string[] }) {\r\n\t\tthis.setScoreboard(data.scoreboard)\r\n\t\tthis.setOnlineStatus(data.online)\r\n\t\tthis.setPlayernames(data.playernames)\r\n\t}\r\n\r\n\tfilter() {\r\n\t\t// Remove non-player / empty entries and sort\r\n\t\tthis.scoreboard.entries = this.scoreboard.entries\r\n\t\t\t.filter(Data.isPlayerOrServer)\r\n\t\t\t.filter(this.isNonemptyEntry.bind(this))\r\n\t\t\t.sort(Intl.Collator().compare)\r\n\r\n\t\t// Remove empty columns\r\n\t\tthis.scoreboard.scores = Data.filter(this.scoreboard.scores, Data.isNonemptyObjective)\r\n\t}\r\n\r\n\tsort(by: string, descending: boolean) {\r\n\t\t// Pre-create collator for significant performance improvement\r\n\t\t// over `a.localeCompare(b, undefined, {sensitivity: \"base\"})`\r\n\t\t// funny / weird thing: for localeCompare, supplying an empty `options`\r\n\t\t// object is way slower than supplying nothing...\r\n\t\tconst collator = new Intl.Collator(undefined, { sensitivity: \"base\" })\r\n\r\n\t\t// When a and b are both numbers, compare as numbers.\r\n\t\t// Otherwise, case-insensitive compare as string\r\n\t\tthis.scores = this.scores.sort((a_row, b_row) => {\r\n\t\t\tconst a = a_row[this.columns_[by]]\r\n\t\t\tconst b = b_row[this.columns_[by]]\r\n\t\t\tif (!isNaN(Number(a)) && !isNaN(Number(b))) {\r\n\t\t\t\treturn (descending ? -1 : 1) * ((a as number) - (b as number))\r\n\t\t\t} else {\r\n\t\t\t\treturn (descending ? -1 : 1) * collator.compare(a as string, b as string)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t// Ignore all entries which have no scores (armour stand book fix)\r\n\t// (also hides entries with only 0 values)\r\n\tisNonemptyEntry = (entry: string) => Object.entries(this.scoreboard.scores)\r\n\t\t.filter(([_, score]) => score[entry] && score[entry] != \"0\").length > 0\r\n\r\n\t// Valid player names only contain between 3 and 16 characters [A-Za-z0-9_],\r\n\t// entries with only digits are ignored as well (common for datapacks)\r\n\tstatic isPlayerOrServer = (entry: string) =>\r\n\t\tentry == \"#server\" || (entry.match(/^\\w{3,16}$/) && !entry.match(/^\\d*$/))\r\n\r\n\t// Whether any entry has a value for this objective\r\n\tstatic isNonemptyObjective = (objective: { [entry: string]: string | number }) =>\r\n\t\tObject.keys(objective).filter(Data.isPlayerOrServer).length > 0\r\n\r\n\t// Array-like filter function for objects\r\n\t// https://stackoverflow.com/a/37616104\r\n\tstatic filter = <V>(obj: { [k: string]: V }, predicate: (_: V) => boolean): { [k: string]: V } =>\r\n\t\tObject.fromEntries(Object.entries(obj).filter(([_, v]) => predicate(v)))\r\n\r\n\t// Likewise, array-like map function for objects\r\n\tstatic map = <V>(obj: { [k: string]: V }, mapper: (k: string, v: V) => V) =>\r\n\t\tObject.fromEntries(Object.entries(obj).map(([k, v]) => [k, mapper(k, v)]))\r\n\r\n}\r\n","type ColourCode =\r\n\t| \"§0\"\r\n\t| \"§1\"\r\n\t| \"§2\"\r\n\t| \"§3\"\r\n\t| \"§4\"\r\n\t| \"§5\"\r\n\t| \"§6\"\r\n\t| \"§7\"\r\n\t| \"§8\"\r\n\t| \"§9\"\r\n\t| \"§a\"\r\n\t| \"§b\"\r\n\t| \"§c\"\r\n\t| \"§d\"\r\n\t| \"§e\"\r\n\t| \"§f\"\r\n\r\ntype FormattingCode =\r\n\t| \"§k\"\r\n\t| \"§l\"\r\n\t| \"§m\"\r\n\t| \"§n\"\r\n\t| \"§o\"\r\n\t| \"§r\"\r\n\r\ntype FormattingCodePart = {\r\n\ttext: string\r\n\tformat?: FormattingCode\r\n\tcolour?: ColourCode | string\r\n\tcolourType?: \"simple\" | \"hex\"\r\n}\r\n\r\nexport default class FormattingCodes {\r\n\tstatic COLOUR_CODES: {[code in ColourCode]: string} = {\r\n\t\t[\"§0\"]: \"black\",\r\n\t\t[\"§1\"]: \"dark_blue\",\r\n\t\t[\"§2\"]: \"dark_green\",\r\n\t\t[\"§3\"]: \"dark_aqua\",\r\n\t\t[\"§4\"]: \"dark_red\",\r\n\t\t[\"§5\"]: \"dark_purple\",\r\n\t\t[\"§6\"]: \"gold\",\r\n\t\t[\"§7\"]: \"gray\",\r\n\t\t[\"§8\"]: \"dark_gray\",\r\n\t\t[\"§9\"]: \"blue\",\r\n\t\t[\"§a\"]: \"green\",\r\n\t\t[\"§b\"]: \"aqua\",\r\n\t\t[\"§c\"]: \"red\",\r\n\t\t[\"§d\"]: \"light_purple\",\r\n\t\t[\"§e\"]: \"yellow\",\r\n\t\t[\"§f\"]: \"white\",\r\n\t}\r\n\r\n\tstatic FORMATTING_CODES: {[code in FormattingCode]: string} = {\r\n\t\t[\"§k\"]: \"obfuscated\",\r\n\t\t[\"§l\"]: \"bold\",\r\n\t\t[\"§m\"]: \"strikethrough\",\r\n\t\t[\"§n\"]: \"underline\",\r\n\t\t[\"§o\"]: \"italic\",\r\n\t\t[\"§r\"]: \"reset\",\r\n\t}\r\n\r\n\t// § followed by a single character, or of the form §x§r§r§g§g§b§b\r\n\t// (also capture rest of string, until next §)\r\n\tstatic FORMATTING_CODE_REGEX = /(§x§.§.§.§.§.§.|§.)([^§]*)/gm\r\n\r\n\t// Replace all formatting codes by <span> elements\r\n\tstatic convertFormattingCodes = (value: string) =>\r\n\t\tFormattingCodes.parseFormattingCodes(value).map(FormattingCodes.convertFormattingCode)\r\n\r\n\t// Convert a single formatting code to a <span> element\r\n\tstatic convertFormattingCode(part: FormattingCodePart) {\r\n\t\tif (!part.format && !part.colour) return part.text\r\n\r\n\t\tconst span = document.createElement(\"span\")\r\n\t\tspan.innerText = part.text\r\n\t\tspan.classList.add(\"mc-format\")\r\n\r\n\t\tif (part.format) span.classList.add(\"mc-\" + part.format)\r\n\t\tif (part.colour) {\r\n\t\t\tif (part.colourType == \"simple\") span.classList.add(\"mc-\" + part.colour)\r\n\t\t\tif (part.colourType == \"hex\") span.style.color = part.colour\r\n\t\t}\r\n\r\n\t\treturn span\r\n\t}\r\n\r\n\tstatic parseFormattingCodes(value: string): FormattingCodePart[] {\r\n\t\tconst parts = []\r\n\r\n\t\tconst firstIdx = value.matchAll(FormattingCodes.FORMATTING_CODE_REGEX).next().value?.index\r\n\t\tif (firstIdx == undefined || firstIdx > 0) {\r\n\t\t\tparts.push({ text: value.substring(0, firstIdx) })\r\n\t\t}\r\n\r\n\t\tfor (const match of value.matchAll(FormattingCodes.FORMATTING_CODE_REGEX)) {\r\n\t\t\tparts.push(FormattingCodes.parseFormattingCode(match[1], match[2], parts[parts.length - 1]))\r\n\t\t}\r\n\r\n\t\treturn parts\r\n\t}\r\n\r\n\tstatic parseFormattingCode(code: string, text: string, prev: FormattingCodePart): FormattingCodePart {\r\n\t\t// Simple colour codes and formatting codes\r\n\t\tif (FormattingCodes.COLOUR_CODES[code]) {\r\n\t\t\treturn {\r\n\t\t\t\ttext,\r\n\t\t\t\tcolour: FormattingCodes.COLOUR_CODES[code],\r\n\t\t\t\tcolourType: \"simple\",\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (FormattingCodes.FORMATTING_CODES[code]) {\r\n\t\t\treturn {\r\n\t\t\t\ttext,\r\n\t\t\t\tformat: FormattingCodes.FORMATTING_CODES[code],\r\n\t\t\t\tcolour: prev?.colour,\r\n\t\t\t\tcolourType: prev?.colourType,\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Hex colour codes\r\n\t\tconst matches = code.match(/§x§(.)§(.)§(.)§(.)§(.)§(.)/m)\r\n\t\tif (matches) {\r\n\t\t\treturn {\r\n\t\t\t\ttext,\r\n\t\t\t\tcolour: \"#\" + matches.slice(1).join(\"\"),\r\n\t\t\t\tcolourType: \"hex\",\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Not a valid formatting code, just return the input unaltered\r\n\t\treturn { text }\r\n\t}\r\n\r\n}\r\n","import Data from \"./Data\"\r\nimport FormattingCodes from \"./FormattingCodes\"\r\nimport Pagination from \"./Pagination\"\r\nimport { Direction, TableConfig } from \"./WebStats\"\r\n\r\nexport default class Display {\r\n\ttable: HTMLTableElement\r\n\tpagination?: Pagination\r\n\tcolumns: string[]\r\n\tsortColumn: string\r\n\tdescending: boolean\r\n\tshowSkins: boolean\r\n\thideOffline: boolean\r\n\r\n\tdata: Data\r\n\theaderElem: HTMLTableRowElement\r\n\trows: Map<string, HTMLTableRowElement>\r\n\r\n\tstatic CONSOLE_IMAGE = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAPElEQVQ4T2NUUlL6z0ABYBw1gGE0DBioHAZ3795lUFZWJildosQCRQaQoxnkVLgL0A2A8dFpdP8NfEICAMkiK2HeQ9JUAAAAAElFTkSuQmCC\"\r\n\r\n\tconstructor({ table, pagination, showSkins = true }, { columns, sortColumn = \"Player\", sortDirection = \"descending\" }: TableConfig) {\r\n\t\tthis.table = table\r\n\t\tthis.pagination = pagination\r\n\t\tthis.columns = columns\r\n\t\tthis.sortColumn = sortColumn\r\n\t\tthis.descending = sortDirection == \"descending\"\r\n\t\tthis.showSkins = showSkins\r\n\t\tthis.hideOffline = false\r\n\r\n\t\tif (this.pagination) this.pagination.onPageChange = (page) => {\r\n\t\t\tthis.updatePagination()\r\n\t\t\tthis.show()\r\n\t\t}\r\n\t}\r\n\r\n\tinit(data: Data) {\r\n\t\tthis.data = data\r\n\r\n\t\t// Set pagination controls\r\n\t\tif (this.pagination) this.updatePagination()\r\n\r\n\t\t// Create header of columns\r\n\t\tthis.headerElem = document.createElement(\"tr\")\r\n\t\tthis.table.append(this.headerElem)\r\n\t\tDisplay.appendTh(this.headerElem, \"Player\", this.thClick.bind(this),\r\n\t\t\tthis.showSkins ? 2 : undefined)\r\n\t\tfor (const column of this.columns ?? this.data.columns) {\r\n\t\t\tDisplay.appendTh(this.headerElem, column, this.thClick.bind(this))\r\n\t\t}\r\n\r\n\t\t// Create rows of (empty) entries\r\n\t\tthis.rows = new Map()\r\n\t\tfor (const entry of this.getEntries()) {\r\n\t\t\tthis.appendEntry(entry)\r\n\t\t}\r\n\r\n\t\t// Fill entries\r\n\t\tthis.updateStatsAndShow()\r\n\t}\r\n\r\n\tgetEntries() {\r\n\t\tconst entriesHere = this.data.entries.filter((entry: string) =>\r\n\t\t\t(this.columns ?? this.data.columns).some((column: string) =>\r\n\t\t\t\tthis.data.scoreboard.scores[column]?.[entry]\r\n\t\t\t\t&& this.data.scoreboard.scores[column][entry] != \"0\"))\r\n\r\n\t\treturn this.hideOffline\r\n\t\t\t? entriesHere.filter(entry => this.data.isOnline(entry))\r\n\t\t\t: entriesHere\r\n\t}\r\n\r\n\tgetScores() {\r\n\t\tconst scoresHere = this.data.scores.filter(row => this.rows.has(row[1]))\r\n\r\n\t\treturn this.hideOffline\r\n\t\t\t? scoresHere.filter(row => this.data.isOnline(row[1]))\r\n\t\t\t: scoresHere\r\n\t}\r\n\r\n\tupdatePagination() {\r\n\t\tthis.pagination.update(this.getEntries().length)\r\n\t}\r\n\r\n\tappendEntry(entry: string) {\r\n\t\tlet tr = document.createElement(\"tr\")\r\n\t\ttr.setAttribute(\"entry\", Display.quoteEscape(entry))\r\n\r\n\t\t// Append skin image\r\n\t\tif (this.showSkins) {\r\n\t\t\tlet img = Display.appendElement(tr, \"td\")\r\n\t\t\tDisplay.appendImg(img, \"\")\r\n\t\t\timg.classList.add(\"sticky\", \"skin\")\r\n\t\t\timg.setAttribute(\"title\", entry)\r\n\t\t}\r\n\r\n\t\t// Append player name\r\n\t\tlet name = Display.appendTextElement(tr, \"td\", entry == \"#server\" ? \"Server\" : entry)\r\n\t\tname.setAttribute(\"objective\", \"Player\")\r\n\t\tname.setAttribute(\"value\", entry)\r\n\r\n\t\t// Prepend online/afk status\r\n\t\tlet status = Display.prependElement(name, \"div\")\r\n\t\tstatus.classList.add(\"status\")\r\n\r\n\t\t// Highlight current player\r\n\t\tif (this.data.isCurrentPlayer(entry)) tr.classList.add(\"current-player\")\r\n\r\n\t\t// Append empty elements for alignment\r\n\t\tfor (const column of this.columns ?? this.data.columns) {\r\n\t\t\tlet td = Display.appendElement(tr, \"td\")\r\n\t\t\ttd.classList.add(\"empty\")\r\n\t\t\ttd.setAttribute(\"objective\", Display.quoteEscape(column))\r\n\t\t}\r\n\t\tthis.rows.set(entry, tr)\r\n\t}\r\n\r\n\tsetSkin(entry: string, row: HTMLTableRowElement) {\r\n\t\tconst img = row.getElementsByTagName(\"img\")[0]\r\n\t\tif (img) {\r\n\t\t\tif (entry == \"#server\") img.src = Display.CONSOLE_IMAGE\r\n\t\t\telse img.src = `https://www.mc-heads.net/avatar/${entry}.png`\r\n\t\t}\r\n\t}\r\n\r\n\tupdateScoreboard() {\r\n\t\tfor (const row of this.data.scores) {\r\n\t\t\tfor (const column of this.columns ?? this.data.columns) {\r\n\t\t\t\tlet value = row[this.data.columns_[column]] as string\r\n\t\t\t\tif (!value) continue\r\n\t\t\t\tconst td = this.rows.get(row[1]).querySelector(`td[objective='${column}']`) as HTMLTableCellElement\r\n\t\t\t\ttd.classList.remove(\"empty\")\r\n\t\t\t\ttd.setAttribute(\"value\", value)\r\n\r\n\t\t\t\t// Convert numbers to locale\r\n\t\t\t\tvalue = isNaN(value as any) ? value : Number(value).toLocaleString()\r\n\r\n\t\t\t\t// Convert Minecraft formatting codes\r\n\t\t\t\ttd.innerHTML = \"\"\r\n\t\t\t\ttd.append(...FormattingCodes.convertFormattingCodes(value))\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tupdateScoreboardAndShow() {\r\n\t\tthis.updateScoreboard()\r\n\t\tthis.show()\r\n\t}\r\n\r\n\tupdateOnlineStatus() {\r\n\t\tfor (const [_, row] of this.rows) {\r\n\t\t\tconst statusElement = row.querySelector(\"td .status\")\r\n\t\t\tif (!statusElement) continue\r\n\t\t\tconst entry = row.getAttribute(\"entry\")\r\n\t\t\trow.classList.remove(\"online\", \"afk\", \"offline\")\r\n\t\t\tstatusElement.classList.remove(\"online\", \"afk\", \"offline\")\r\n\r\n\t\t\tconst status = this.data.getStatus(entry)\r\n\t\t\trow.classList.add(status.toLowerCase())\r\n\t\t\tstatusElement.classList.add(status.toLowerCase())\r\n\t\t\tstatusElement.setAttribute(\"title\", this.data.getStatus(entry))\r\n\t\t}\r\n\t}\r\n\r\n\tupdateOnlineStatusAndShow() {\r\n\t\tthis.updateOnlineStatus()\r\n\t\tif (this.pagination && this.hideOffline) this.show()\r\n\t}\r\n\r\n\tupdateStats() {\r\n\t\tthis.updateScoreboard()\r\n\t\tthis.updateOnlineStatus()\r\n\t}\r\n\r\n\tupdateStatsAndShow() {\r\n\t\tthis.updateScoreboard()\r\n\t\tthis.updateOnlineStatus()\r\n\t\tthis.show()\r\n\t}\r\n\r\n\tchangeHideOffline(hideOffline: boolean) {\r\n\t\tthis.hideOffline = hideOffline\r\n\t\tif (this.pagination) {\r\n\t\t\tthis.pagination.changePage(1)\r\n\t\t\tthis.show()\r\n\t\t}\r\n\t}\r\n\r\n\t// Re-display table contents\r\n\tshow() {\r\n\t\tthis.table.innerHTML = \"\"\r\n\t\tthis.table.append(this.headerElem)\r\n\t\tconst scores = this.getScores()\r\n\t\tconst [min, max] = this.pagination\r\n\t\t\t? this.pagination.getRange(scores.length)\r\n\t\t\t: [0, scores.length]\r\n\t\tfor (let i = min; i < max; i++) {\r\n\t\t\tif (this.showSkins) this.setSkin(scores[i][1], this.rows.get(scores[i][1]))\r\n\t\t\tthis.table.append(this.rows.get(scores[i][1]))\r\n\t\t}\r\n\t}\r\n\r\n\t// Sort a HTML table element\r\n\tsort(by: string = this.sortColumn, descending: boolean = this.descending) {\r\n\t\tthis.data.sort(by, descending)\r\n\t\tthis.show()\r\n\t}\r\n\r\n\t// When a table header is clicked, sort by that header\r\n\tthClick(e: Event) {\r\n\t\tlet objective = (e.target as HTMLTableCellElement).innerText\r\n\t\tthis.descending = (objective === this.sortColumn) ? !this.descending : true\r\n\t\tthis.sortColumn = objective\r\n\t\tif (this.pagination) this.pagination.changePage(1)\r\n\t\tthis.sort()\r\n\t}\r\n\r\n\t// Replace single quotes by '&quot;' (html-escape)\r\n\tstatic quoteEscape = (string: string) => string.replace(/'/g, \"&quot;\")\r\n\r\n\tstatic appendElement<K extends keyof HTMLElementTagNameMap>(base: HTMLElement, type: K) {\r\n\t\tlet el = document.createElement(type)\r\n\t\tbase.append(el)\r\n\t\treturn el\r\n\t}\r\n\r\n\tstatic prependElement<K extends keyof HTMLElementTagNameMap>(base: HTMLElement, type: K) {\r\n\t\tlet el = document.createElement(type)\r\n\t\tdocument.createElement\r\n\t\tbase.prepend(el)\r\n\t\treturn el\r\n\t}\r\n\r\n\tstatic appendTextElement<K extends keyof HTMLElementTagNameMap>(base: HTMLElement, type: K, name: string) {\r\n\t\tlet el = Display.appendElement(base, type)\r\n\t\tel.innerText = name\r\n\t\treturn el\r\n\t}\r\n\r\n\tstatic appendTh(base: HTMLElement, name: string, onclick: (this, ev) => any, colspan?: number) {\r\n\t\tlet th = Display.appendTextElement(base, \"th\", name)\r\n\t\tth.onclick = onclick\r\n\t\tif (colspan != undefined) th.setAttribute(\"colspan\", String(colspan))\r\n\t\treturn th\r\n\t}\r\n\r\n\tstatic appendImg(base: HTMLElement, src: string) {\r\n\t\tlet img = Display.appendElement(base, \"img\")\r\n\t\timg.src = src\r\n\t\treturn img\r\n\t}\r\n\r\n}\r\n","export default class Pagination {\r\n\tmaxPage: number\r\n\tdisplayCount: number\r\n\tcurrentPage: number\r\n\r\n\tparentElem: HTMLElement\r\n\tselectElem: HTMLSelectElement\r\n\tprevButton: HTMLButtonElement\r\n\tnextButton: HTMLButtonElement\r\n\r\n\tonPageChange: (page: number) => void\r\n\r\n\tconstructor(displayCount: number, elem: HTMLElement) {\r\n\t\tthis.displayCount = displayCount\r\n\t\tthis.currentPage = 1\r\n\t\t\r\n\t\tthis.parentElem = elem\r\n\t\tthis.selectElem = elem.querySelector(\"select.webstats-pagination[name=page]\")\r\n\t\tthis.prevButton = elem.querySelector(\"button.webstats-pagination[name=prev]\")\r\n\t\tthis.nextButton = elem.querySelector(\"button.webstats-pagination[name=next]\")\r\n\r\n\t\tthis.selectElem.addEventListener(\"change\",\r\n\t\t\t(e) => this.changePageAndCallback(Number((e.target as HTMLSelectElement).value)))\r\n\t\tthis.prevButton.addEventListener(\"click\",\r\n\t\t\t() => this.changePageAndCallback(this.currentPage - 1))\r\n\t\tthis.nextButton.addEventListener(\"click\",\r\n\t\t\t() => this.changePageAndCallback(this.currentPage + 1))\r\n\t}\r\n\r\n\tstatic create(displayCount: number, elem: HTMLElement) {\r\n\t\tconst prevButton = elem.appendChild(document.createElement(\"button\"))\r\n\t\tprevButton.classList.add(\"webstats-pagination\")\r\n\t\tprevButton.name = \"prev\"\r\n\t\tprevButton.innerText = \"Prev\"\r\n\r\n\t\tconst pageSelect = elem.appendChild(document.createElement(\"select\"))\r\n\t\tpageSelect.classList.add(\"webstats-pagination\")\r\n\t\tpageSelect.name = \"page\"\r\n\r\n\t\tconst nextButton = elem.appendChild(document.createElement(\"button\"))\r\n\t\tnextButton.classList.add(\"webstats-pagination\")\r\n\t\tnextButton.name = \"next\"\r\n\t\tnextButton.innerText = \"Next\"\r\n\r\n\t\treturn new Pagination(displayCount, elem)\r\n\t}\r\n\r\n\tupdate(nEntries: number) {\r\n\t\tthis.maxPage = Math.ceil(nEntries / this.displayCount)\r\n\t\t\r\n\t\t// Hide all controls when there is only one page\r\n\t\tif (this.maxPage == 1) {\r\n\t\t\tthis.parentElem.classList.add(\"pagination-hidden\")\r\n\t\t} else {\r\n\t\t\tthis.parentElem.classList.remove(\"pagination-hidden\")\r\n\t\t}\r\n\r\n\t\t// Page selector\r\n\t\tif (this.selectElem) {\r\n\t\t\tthis.selectElem.innerHTML = \"\"\r\n\t\t\tfor (let i = 1; i <= this.maxPage; i++) {\r\n\t\t\t\tconst optionElem = document.createElement(\"option\")\r\n\t\t\t\toptionElem.innerText = String(i)\r\n\t\t\t\tthis.selectElem.append(optionElem)\r\n\t\t\t}\r\n\t\t\tthis.selectElem.value = String(this.currentPage)\r\n\t\t}\r\n\r\n\t\t// \"Prev\" button\r\n\t\tif (this.prevButton) this.prevButton.toggleAttribute(\"disabled\", this.currentPage <= 1)\r\n\r\n\t\t// \"Next\" button\r\n\t\tif (this.nextButton) this.nextButton.toggleAttribute(\"disabled\", this.currentPage >= this.maxPage)\r\n\t}\r\n\r\n\tchangePage(page: number) {\r\n\t\tpage = Math.max(1, Math.min(page, this.maxPage))\r\n\t\tthis.currentPage = page\r\n\t}\r\n\r\n\tchangePageAndCallback(page: number) {\r\n\t\tthis.changePage(page)\r\n\t\tconsole.log(\"callback\")\r\n\t\tif (this.onPageChange) this.onPageChange(this.currentPage)\r\n\t}\r\n\r\n\tgetRange(nEntries?: number): [number, number] {\r\n\t\tconst min = (this.currentPage - 1) * this.displayCount\r\n\t\tconst max = (this.displayCount > 0)\r\n\t\t\t? Math.min(this.currentPage * this.displayCount, nEntries)\r\n\t\t\t: nEntries\r\n\t\treturn [min, max]\r\n\t}\r\n\r\n}\r\n","import Connection from \"./Connection\"\r\nimport Data from \"./Data\"\r\nimport Display from \"./Display\"\r\nimport Pagination from \"./Pagination\"\r\n\r\ndeclare global {\r\n\tinterface Window { webstats: WebStats }\r\n}\r\n\r\nexport type Direction = \"ascending\" | \"descending\"\r\n\r\nexport type TableConfig = {\r\n\tname?: string\r\n\tcolumns?: string[]\r\n\tsortColumn?: string\r\n\tsortDirection?: Direction\r\n}\r\n\r\nexport default class WebStats {\r\n\tstatic CONNECTION_ERROR_MSG = \"No connection to server. Either the server is offline, or the 'host' setting in index.html is incorrect.\"\r\n\r\n\tdisplays: Display[]\r\n\tconnection: Connection\r\n\tdata: Data\r\n\tupdateInterval: number\r\n\tinterval: number\r\n\r\n\tloadingElem?: HTMLElement\r\n\terrorElem?: HTMLElement\r\n\r\n\tconstructor(config) {\r\n\t\tthis.displays = []\r\n\t\tthis.connection = config.connection ?? Connection.json(config.host)\r\n\t\tthis.updateInterval = config.updateInterval ?? 10000\r\n\r\n\t\t// Status HTML elements\r\n\t\tconst statusElem = document.querySelector(\".webstats-status\")\r\n\t\tthis.loadingElem = statusElem?.querySelector(\".webstats-loading-indicator\")\r\n\t\tthis.errorElem = statusElem?.querySelector(\".webstats-error-message\")\r\n\t\tthis.setLoadingStatus(true)\r\n\r\n\t\t// Get data and init\r\n\t\tconst statsPromise = this.connection.getStats()\r\n\t\t\t.catch(this.catchError(WebStats.CONNECTION_ERROR_MSG, config))\r\n\t\tconst tableConfigsPromise = this.connection.getTables()\r\n\t\t\t.catch(this.catchError(WebStats.CONNECTION_ERROR_MSG, config))\r\n\t\tPromise.all([statsPromise, tableConfigsPromise])\r\n\t\t\t.then(([stats, tableConfigs]) => this.init(stats, tableConfigs, config))\r\n\t\t\t.catch(this.catchError(undefined, config))\r\n\r\n\t\t// Get saved toggles from cookies\r\n\t\tconst cookies = document.cookie.split(\"; \") ?? []\r\n\t\tcookies.filter(str => str.length > 0).forEach(cookie => {\r\n\t\t\tconst [property, value] = cookie.match(/[^=]+/g)\r\n\t\t\tdocument.documentElement.classList.toggle(property, value == \"true\")\r\n\t\t\tconst el = document.querySelector(\"input.webstats-option#\" + property) as HTMLInputElement\r\n\t\t\tif (el) el.checked = (value == \"true\")\r\n\t\t})\r\n\r\n\t\t// On config option toggle, set the html element's class and store cookie\r\n\t\tdocument.querySelectorAll(\"input.webstats-option\").forEach(el =>\r\n\t\t\tel.addEventListener(\"change\", () => {\r\n\t\t\t\tdocument.documentElement.classList.toggle(el.id, (el as HTMLInputElement).checked)\r\n\t\t\t\t// Set a cookie which expires in 10 years\r\n\t\t\t\tdocument.cookie = `${el.id}=${(el as HTMLInputElement).checked}; max-age=${60 * 60 * 24 * 365 * 10}; SameSite=Lax`\r\n\t\t\t})\r\n\t\t)\r\n\r\n\t\tconst optionHideOffline = document.querySelector(\"input.webstats-option#hide-offline\") as HTMLInputElement\r\n\t\tif (optionHideOffline) {\r\n\t\t\t// Re-show if displayCount is set\r\n\t\t\toptionHideOffline.addEventListener(\"change\", (e) => {\r\n\t\t\t\tthis.displays.forEach(display => display.changeHideOffline(optionHideOffline.checked))\r\n\t\t\t})\r\n\t\t\tthis.displays.forEach(display => display.changeHideOffline(optionHideOffline.checked))\r\n\t\t}\r\n\r\n\t\twindow.webstats = this\r\n\t}\r\n\r\n\tinit(data, tableConfigs: TableConfig[] | undefined, config) {\r\n\t\tif (config.tables) {\r\n\t\t\tfor (const tableName in config.tables) {\r\n\t\t\t\tconst tableConfig = tableConfigs\r\n\t\t\t\t\t? tableConfigs.find(tc => (tc.name ?? \"\") == tableName)\r\n\t\t\t\t\t: { colums: data.scoreboard.columns as string[] } as TableConfig\r\n\t\t\t\tif (tableConfig) this.addTableManual(config, tableConfig)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (tableConfigs) {\r\n\t\t\t\tfor (const tableConfig of tableConfigs) {\r\n\t\t\t\t\tthis.addTableAutomatic(config, tableConfig)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.addTableAutomatic(config, { colums: data.scoreboard.columns as string[] } as TableConfig)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.data = new Data(data)\r\n\t\tthis.displays.forEach(display => {\r\n\t\t\tdisplay.init(this.data)\r\n\t\t\tdisplay.sort()\r\n\t\t})\r\n\r\n\t\t// Set update interval\r\n\t\tif (this.updateInterval > 0) this.startUpdateInterval(true)\r\n\t\tdocument.addEventListener(\"visibilitychange\", () => document.hidden\r\n\t\t\t? this.stopUpdateInterval() : this.startUpdateInterval())\r\n\r\n\t\tthis.setLoadingStatus(false)\r\n\t}\r\n\r\n\tupdate() {\r\n\t\t// When nobody is online, assume scoreboard does not change\r\n\t\tif (this.data.nOnline > 0) {\r\n\t\t\tthis.connection.getStats().then(data => {\r\n\t\t\t\tthis.data.setStats(data)\r\n\t\t\t\tthis.displays.forEach(display => display.updateStatsAndShow())\r\n\t\t\t}).catch(this.catchError(WebStats.CONNECTION_ERROR_MSG))\r\n\t\t} else {\r\n\t\t\tthis.connection.getOnline().then(data => {\r\n\t\t\t\tthis.data.setOnlineStatus(data)\r\n\t\t\t\tthis.displays.forEach(display => display.updateOnlineStatusAndShow())\r\n\t\t\t}).catch(this.catchError(WebStats.CONNECTION_ERROR_MSG))\r\n\t\t}\r\n\t}\r\n\r\n\tstartUpdateInterval(first?: boolean) {\r\n\t\tthis.interval = setInterval(this.update.bind(this) as TimerHandler, this.updateInterval)\r\n\t\tif (!first) this.update()\r\n\t}\r\n\r\n\tstopUpdateInterval() {\r\n\t\tclearInterval(this.interval)\r\n\t}\r\n\r\n\taddTableManual(config, tableConfig: TableConfig) {\r\n\t\tlet pagination: Pagination\r\n\t\tif (config.displayCount > 0 && config.tables[tableConfig.name ?? \"\"].pagination) {\r\n\t\t\tconst paginationParent = config.tables[tableConfig.name ?? \"\"].pagination\r\n\t\t\tpagination = new Pagination(config.displayCount, paginationParent)\r\n\t\t}\r\n\t\tthis.displays.push(new Display(\r\n\t\t\t{ ...config, table: config.tables[tableConfig.name ?? \"\"].table, pagination: pagination },\r\n\t\t\ttableConfig\r\n\t\t))\r\n\t}\r\n\r\n\taddTableAutomatic(config, tableConfig: TableConfig) {\r\n\t\tconst headerElem = (config.tableParent as HTMLElement)\r\n\t\t\t.appendChild(document.createElement(\"div\"))\r\n\t\theaderElem.classList.add(\"webstats-tableheading\")\r\n\t\tif (tableConfig.name) {\r\n\t\t\theaderElem.innerText = tableConfig.name\r\n\t\t\theaderElem.setAttribute(\"webstats-table\", tableConfig.name)\r\n\t\t}\r\n\r\n\t\tlet pagination: Pagination\r\n\t\tif (config.displayCount > 0) {\r\n\t\t\tconst paginationControls = headerElem.appendChild(document.createElement(\"span\"))\r\n\t\t\tpaginationControls.classList.add(\"webstats-pagination\")\r\n\t\t\tpagination = Pagination.create(config.displayCount, paginationControls)\r\n\t\t}\r\n\r\n\t\tconst tableElem = (config.tableParent as HTMLElement)\r\n\t\t\t.appendChild(document.createElement(\"table\"))\r\n\t\tif (tableConfig.name) tableElem.setAttribute(\"webstats-table\", tableConfig.name)\r\n\t\tthis.displays.push(new Display(\r\n\t\t\t{ ...config, table: tableElem, pagination: pagination },\r\n\t\t\ttableConfig\r\n\t\t))\r\n\t}\r\n\r\n\tsetLoadingStatus(loading) {\r\n\t\tif (!this.loadingElem) return\r\n\t\tthis.loadingElem.style.display = loading ? \"inline\" : \"none\"\r\n\t}\r\n\r\n\tsetErrorMessage(msg: string, config?) {\r\n\t\tif (this.errorElem) this.errorElem.innerText = msg\r\n\t\telse {\r\n\t\t\tconst spanElem = document.createElement(\"span\")\r\n\t\t\tspanElem.innerText = msg\r\n\t\t\tspanElem.classList.add(\"webstats-error-message\")\r\n\t\t\tif (config?.tableParent) {\r\n\t\t\t\tconfig.tableParent.appendChild(spanElem)\r\n\t\t\t} else if (config?.tables) {\r\n\t\t\t\tfor (const tablename in config.tables) {\r\n\t\t\t\t\tif (config.tables[tablename].table) config.tables[tablename].table.appendChild(spanElem)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcatchError(msg?: string, config?) {\r\n\t\tconst self = this\r\n\t\treturn e => {\r\n\t\t\tconsole.error(e)\r\n\t\t\tif (msg) console.warn(msg)\r\n\t\t\tself.setErrorMessage(msg ?? e, config)\r\n\t\t\tself.setLoadingStatus(false)\r\n\t\t\tself.stopUpdateInterval()\r\n\t\t}\r\n\t}\r\n\r\n}\r\n"],"names":["Connection","constructor","all","scores","online","tables","this","getStats","async","fetch","json","scoreboard","Promise","getOnline","getScoreboard","then","response","catch","getTables","static","host","Data","data","isOnline","player","players","isAFK","isOffline","getStatus","isCurrentPlayer","playernames","includes","isNonemptyEntry","entry","Object","entries","filter","_","score","length","setStats","nOnline","keys","setScoreboard","columns","sort","entryName","push","columnName","columns_","Player","forEach","val","idx","setOnlineStatus","setPlayernames","isPlayerOrServer","bind","Intl","Collator","compare","isNonemptyObjective","by","descending","collator","undefined","sensitivity","a_row","b_row","a","b","isNaN","Number","match","objective","obj","predicate","fromEntries","v","map","mapper","k","FormattingCodes","part","format","colour","text","span","document","createElement","innerText","classList","add","colourType","style","color","value","parts","firstIdx","matchAll","FORMATTING_CODE_REGEX","next","index","substring","parseFormattingCode","code","prev","COLOUR_CODES","FORMATTING_CODES","matches","slice","join","convertFormattingCodes","parseFormattingCodes","convertFormattingCode","Display","table","pagination","showSkins","sortColumn","sortDirection","hideOffline","onPageChange","page","updatePagination","show","init","headerElem","append","appendTh","thClick","column","rows","Map","getEntries","appendEntry","updateStatsAndShow","entriesHere","some","getScores","scoresHere","row","has","update","tr","setAttribute","quoteEscape","img","appendElement","appendImg","name","appendTextElement","prependElement","td","set","setSkin","getElementsByTagName","src","CONSOLE_IMAGE","updateScoreboard","get","querySelector","remove","toLocaleString","innerHTML","updateScoreboardAndShow","updateOnlineStatus","statusElement","getAttribute","status","toLowerCase","updateOnlineStatusAndShow","updateStats","changeHideOffline","changePage","min","max","getRange","i","e","target","base","type","el","prepend","onclick","colspan","th","String","string","replace","Pagination","displayCount","elem","currentPage","parentElem","selectElem","prevButton","nextButton","addEventListener","changePageAndCallback","appendChild","pageSelect","nEntries","maxPage","Math","ceil","optionElem","toggleAttribute","console","log","WebStats","config","displays","connection","updateInterval","statusElem","loadingElem","errorElem","setLoadingStatus","statsPromise","catchError","CONNECTION_ERROR_MSG","tableConfigsPromise","stats","tableConfigs","cookie","split","str","property","documentElement","toggle","checked","querySelectorAll","id","optionHideOffline","display","window","webstats","tableName","tableConfig","find","tc","colums","addTableManual","addTableAutomatic","startUpdateInterval","hidden","stopUpdateInterval","first","interval","setInterval","clearInterval","paginationParent","tableParent","paginationControls","create","tableElem","loading","setErrorMessage","msg","spanElem","tablename","self","error","warn"],"mappings":";;;;;;;;AAAc,MAAOA,EAMpBC,aAAYC,IAAEA,EAAGC,OAAEA,EAAMC,OAAEA,EAAMC,OAAEA,IAgBnCC,KAAQC,SAAGC,UACV,GAAIF,KAAKJ,IACR,mBAAoBO,MAAMH,KAAKJ,MAAMQ,OAC/B,CACN,MAAON,EAAQO,SAAoBC,QAAQV,IAAI,CAACI,KAAKO,YAAaP,KAAKQ,kBACvE,MAAO,CAAEV,SAAQO,aACjB,GAEFL,KAAAQ,cAAgB,IAAML,MAAMH,KAAKH,QAAQY,MAAKC,GAAYA,EAASN,SAAQO,OAAM,SACjFX,KAAAO,UAAY,IAAMJ,MAAMH,KAAKF,QAAQW,MAAKC,GAAYA,EAASN,SAAQO,OAAM,SAC7EX,KAAAY,UAAY,IAAMT,MAAMH,KAAKD,QAAQU,MAAKC,GAAYA,EAASN,SAAQO,OAAM,SAzB5EX,KAAKJ,IAAMA,EACXI,KAAKH,OAASA,EACdG,KAAKF,OAASA,EACdE,KAAKD,OAASA,CACd,CAEDc,YAAYC,GACX,OAAO,IAAIpB,EAAW,CACrBE,IAAM,UAAUkB,eAChBjB,OAAS,UAAUiB,oBACnBhB,OAAS,UAAUgB,gBACnBf,OAAS,UAAUe,iBAEpB,ECZY,MAAOC,EAQpBpB,YAAYqB,GAQZhB,KAAAiB,SAAYC,IAA4C,IAAzBlB,KAAKmB,QAAQD,GAC5ClB,KAAAoB,MAASF,GAA4C,QAAzBlB,KAAKmB,QAAQD,GACzClB,KAAAqB,UAAaH,KAAqBlB,KAAKmB,QAAQD,GAC/ClB,KAAAsB,UAAaJ,GAAmBlB,KAAKiB,SAASC,GAAU,SACpDlB,KAAKoB,MAAMF,GAAU,MAAQ,UACjClB,KAAAuB,gBAAmBL,GAAmBlB,KAAKwB,aAAaC,SAASP,KAAW,EAgE5ElB,KAAA0B,gBAAmBC,GAAkBC,OAAOC,QAAQ7B,KAAKK,WAAWR,QAClEiC,QAAO,EAAEC,EAAGC,KAAWA,EAAML,IAA0B,KAAhBK,EAAML,KAAeM,OAAS,EA7EtEjC,KAAKkC,SAASlB,EACd,CAEGa,cAAY,OAAO7B,KAAKK,WAAWwB,OAAS,CAC5C/B,aAAW,OAAOE,KAAKmB,OAAS,CAChCgB,cAAY,OAAOP,OAAOQ,KAAKpC,KAAKmB,SAASc,MAAQ,CASzDI,cAAchC,GACbL,KAAKK,WAAaA,EAClBL,KAAKsC,QAAUV,OAAOQ,KAAK/B,EAAWR,QAAQ0C,OAE9CvC,KAAK8B,SAEL9B,KAAKH,OAAS,GACd,IAAK,MAAM2C,KAAaxC,KAAK6B,QAAS,CACrC,MAAMF,EAAQ,GACdA,EAAMc,KAAKzC,KAAKH,OAAO4C,KAAKd,GAAkB,GAC9CA,EAAMc,KAAKD,GACX,IAAK,MAAME,KAAc1C,KAAKsC,QAC7BX,EAAMc,KAAKzC,KAAKK,WAAWR,OAAO6C,KAAcF,IAAc,EAE/D,CAIDxC,KAAK2C,SAAW,CAAEC,OAAQ,GAC1B5C,KAAKsC,QAAQO,SAAQ,CAACC,EAAKC,IAAQ/C,KAAK2C,SAASG,GAAOC,EAAM,GAC9D,CACDC,gBAAgBlD,GAAkBE,KAAKmB,QAAUrB,CAAQ,CACzDmD,eAAezB,GAAyBxB,KAAKwB,YAAcA,CAAa,CACxEU,SAASlB,GACRhB,KAAKqC,cAAcrB,EAAKX,YACxBL,KAAKgD,gBAAgBhC,EAAKlB,QAC1BE,KAAKiD,eAAejC,EAAKQ,YACzB,CAEDM,SAEC9B,KAAKK,WAAWwB,QAAU7B,KAAKK,WAAWwB,QACxCC,OAAOf,EAAKmC,kBACZpB,OAAO9B,KAAK0B,gBAAgByB,KAAKnD,OACjCuC,KAAKa,KAAKC,WAAWC,SAGvBtD,KAAKK,WAAWR,OAASkB,EAAKe,OAAO9B,KAAKK,WAAWR,OAAQkB,EAAKwC,oBAClE,CAEDhB,KAAKiB,EAAYC,GAKhB,MAAMC,EAAW,IAAIN,KAAKC,cAASM,EAAW,CAAEC,YAAa,SAI7D5D,KAAKH,OAASG,KAAKH,OAAO0C,MAAK,CAACsB,EAAOC,KACtC,MAAMC,EAAIF,EAAM7D,KAAK2C,SAASa,IACxBQ,EAAIF,EAAM9D,KAAK2C,SAASa,IAC9B,OAAKS,MAAMC,OAAOH,KAAQE,MAAMC,OAAOF,KAG9BP,GAAc,EAAI,GAAKC,EAASJ,QAAQS,EAAaC,IAFrDP,GAAc,EAAI,IAAOM,EAAgBC,EAGjD,GAEF,EASMjD,EAAgBmC,iBAAIvB,GACjB,WAATA,GAAuBA,EAAMwC,MAAM,gBAAkBxC,EAAMwC,MAAM,SAG3DpD,EAAmBwC,oBAAIa,GAC7BxC,OAAOQ,KAAKgC,GAAWtC,OAAOf,EAAKmC,kBAAkBjB,OAAS,EAIxDlB,EAAAe,OAAS,CAAIuC,EAAyBC,IAC5C1C,OAAO2C,YAAY3C,OAAOC,QAAQwC,GAAKvC,QAAO,EAAEC,EAAGyC,KAAOF,EAAUE,MAG9DzD,EAAA0D,IAAM,CAAIJ,EAAyBK,IACzC9C,OAAO2C,YAAY3C,OAAOC,QAAQwC,GAAKI,KAAI,EAAEE,EAAGH,KAAO,CAACG,EAAGD,EAAOC,EAAGH,OC/EzD,MAAOI,EAsCpB/D,6BAA6BgE,GAC5B,IAAKA,EAAKC,SAAWD,EAAKE,OAAQ,OAAOF,EAAKG,KAE9C,MAAMC,EAAOC,SAASC,cAAc,QAUpC,OATAF,EAAKG,UAAYP,EAAKG,KACtBC,EAAKI,UAAUC,IAAI,aAEfT,EAAKC,QAAQG,EAAKI,UAAUC,IAAI,MAAQT,EAAKC,QAC7CD,EAAKE,SACe,UAAnBF,EAAKU,YAAwBN,EAAKI,UAAUC,IAAI,MAAQT,EAAKE,QAC1C,OAAnBF,EAAKU,aAAqBN,EAAKO,MAAMC,MAAQZ,EAAKE,SAGhDE,CACP,CAEDpE,4BAA4B6E,GAC3B,MAAMC,EAAQ,GAERC,EAAWF,EAAMG,SAASjB,EAAgBkB,uBAAuBC,OAAOL,OAAOM,OACrErC,MAAZiC,GAAyBA,EAAW,IACvCD,EAAMlD,KAAK,CAAEuC,KAAMU,EAAMO,UAAU,EAAGL,KAGvC,IAAK,MAAMzB,KAASuB,EAAMG,SAASjB,EAAgBkB,uBAClDH,EAAMlD,KAAKmC,EAAgBsB,oBAAoB/B,EAAM,GAAIA,EAAM,GAAIwB,EAAMA,EAAM1D,OAAS,KAGzF,OAAO0D,CACP,CAED9E,2BAA2BsF,EAAcnB,EAAcoB,GAEtD,GAAIxB,EAAgByB,aAAaF,GAChC,MAAO,CACNnB,OACAD,OAAQH,EAAgByB,aAAaF,GACrCZ,WAAY,UAGd,GAAIX,EAAgB0B,iBAAiBH,GACpC,MAAO,CACNnB,OACAF,OAAQF,EAAgB0B,iBAAiBH,GACzCpB,OAAQqB,GAAMrB,OACdQ,WAAYa,GAAMb,YAKpB,MAAMgB,EAAUJ,EAAKhC,MAAM,+BAC3B,OAAIoC,EACI,CACNvB,OACAD,OAAQ,IAAMwB,EAAQC,MAAM,GAAGC,KAAK,IACpClB,WAAY,OAKP,CAAEP,OACT,EAlGMJ,EAAAyB,aAA+C,CACrD,KAAQ,QACR,KAAQ,YACR,KAAQ,aACR,KAAQ,YACR,KAAQ,WACR,KAAQ,cACR,KAAQ,OACR,KAAQ,OACR,KAAQ,YACR,KAAQ,OACR,KAAQ,QACR,KAAQ,OACR,KAAQ,MACR,KAAQ,eACR,KAAQ,SACR,KAAQ,SAGFzB,EAAA0B,iBAAuD,CAC7D,KAAQ,aACR,KAAQ,OACR,KAAQ,gBACR,KAAQ,YACR,KAAQ,SACR,KAAQ,SAKF1B,EAAqBkB,sBAAG,+BAGxBlB,EAAA8B,uBAA0BhB,GAChCd,EAAgB+B,qBAAqBjB,GAAOjB,IAAIG,EAAgBgC,uBC/DpD,MAAOC,EAepBlH,aAAYmH,MAAEA,EAAKC,WAAEA,EAAUC,UAAEA,GAAY,IAAQ1E,QAAEA,EAAO2E,WAAEA,EAAa,SAAQC,cAAEA,EAAgB,eACtGlH,KAAK8G,MAAQA,EACb9G,KAAK+G,WAAaA,EAClB/G,KAAKsC,QAAUA,EACftC,KAAKiH,WAAaA,EAClBjH,KAAKyD,WAA8B,cAAjByD,EAClBlH,KAAKgH,UAAYA,EACjBhH,KAAKmH,aAAc,EAEfnH,KAAK+G,aAAY/G,KAAK+G,WAAWK,aAAgBC,IACpDrH,KAAKsH,mBACLtH,KAAKuH,MAAM,EAEZ,CAEDC,KAAKxG,GACJhB,KAAKgB,KAAOA,EAGRhB,KAAK+G,YAAY/G,KAAKsH,mBAG1BtH,KAAKyH,WAAavC,SAASC,cAAc,MACzCnF,KAAK8G,MAAMY,OAAO1H,KAAKyH,YACvBZ,EAAQc,SAAS3H,KAAKyH,WAAY,SAAUzH,KAAK4H,QAAQzE,KAAKnD,MAC7DA,KAAKgH,UAAY,OAAIrD,GACtB,IAAK,MAAMkE,KAAU7H,KAAKsC,SAAWtC,KAAKgB,KAAKsB,QAC9CuE,EAAQc,SAAS3H,KAAKyH,WAAYI,EAAQ7H,KAAK4H,QAAQzE,KAAKnD,OAI7DA,KAAK8H,KAAO,IAAIC,IAChB,IAAK,MAAMpG,KAAS3B,KAAKgI,aACxBhI,KAAKiI,YAAYtG,GAIlB3B,KAAKkI,oBACL,CAEDF,aACC,MAAMG,EAAcnI,KAAKgB,KAAKa,QAAQC,QAAQH,IAC5C3B,KAAKsC,SAAWtC,KAAKgB,KAAKsB,SAAS8F,MAAMP,GACzC7H,KAAKgB,KAAKX,WAAWR,OAAOgI,KAAUlG,IACW,KAA9C3B,KAAKgB,KAAKX,WAAWR,OAAOgI,GAAQlG,OAEzC,OAAO3B,KAAKmH,YACTgB,EAAYrG,QAAOH,GAAS3B,KAAKgB,KAAKC,SAASU,KAC/CwG,CACH,CAEDE,YACC,MAAMC,EAAatI,KAAKgB,KAAKnB,OAAOiC,QAAOyG,GAAOvI,KAAK8H,KAAKU,IAAID,EAAI,MAEpE,OAAOvI,KAAKmH,YACTmB,EAAWxG,QAAOyG,GAAOvI,KAAKgB,KAAKC,SAASsH,EAAI,MAChDD,CACH,CAEDhB,mBACCtH,KAAK+G,WAAW0B,OAAOzI,KAAKgI,aAAa/F,OACzC,CAEDgG,YAAYtG,GACX,IAAI+G,EAAKxD,SAASC,cAAc,MAIhC,GAHAuD,EAAGC,aAAa,QAAS9B,EAAQ+B,YAAYjH,IAGzC3B,KAAKgH,UAAW,CACnB,IAAI6B,EAAMhC,EAAQiC,cAAcJ,EAAI,MACpC7B,EAAQkC,UAAUF,EAAK,IACvBA,EAAIxD,UAAUC,IAAI,SAAU,QAC5BuD,EAAIF,aAAa,QAAShH,EAC1B,CAGD,IAAIqH,EAAOnC,EAAQoC,kBAAkBP,EAAI,KAAe,WAAT/G,EAAqB,SAAWA,GAC/EqH,EAAKL,aAAa,YAAa,UAC/BK,EAAKL,aAAa,QAAShH,GAGdkF,EAAQqC,eAAeF,EAAM,OACnC3D,UAAUC,IAAI,UAGjBtF,KAAKgB,KAAKO,gBAAgBI,IAAQ+G,EAAGrD,UAAUC,IAAI,kBAGvD,IAAK,MAAMuC,KAAU7H,KAAKsC,SAAWtC,KAAKgB,KAAKsB,QAAS,CACvD,IAAI6G,EAAKtC,EAAQiC,cAAcJ,EAAI,MACnCS,EAAG9D,UAAUC,IAAI,SACjB6D,EAAGR,aAAa,YAAa9B,EAAQ+B,YAAYf,GACjD,CACD7H,KAAK8H,KAAKsB,IAAIzH,EAAO+G,EACrB,CAEDW,QAAQ1H,EAAe4G,GACtB,MAAMM,EAAMN,EAAIe,qBAAqB,OAAO,GACxCT,IACqBA,EAAIU,IAAf,WAAT5H,EAA8BkF,EAAQ2C,cAC3B,mCAAmC7H,QAEnD,CAED8H,mBACC,IAAK,MAAMlB,KAAOvI,KAAKgB,KAAKnB,OAC3B,IAAK,MAAMgI,KAAU7H,KAAKsC,SAAWtC,KAAKgB,KAAKsB,QAAS,CACvD,IAAIoD,EAAQ6C,EAAIvI,KAAKgB,KAAK2B,SAASkF,IACnC,IAAKnC,EAAO,SACZ,MAAMyD,EAAKnJ,KAAK8H,KAAK4B,IAAInB,EAAI,IAAIoB,cAAc,iBAAiB9B,OAChEsB,EAAG9D,UAAUuE,OAAO,SACpBT,EAAGR,aAAa,QAASjD,GAGzBA,EAAQzB,MAAMyB,GAAgBA,EAAQxB,OAAOwB,GAAOmE,iBAGpDV,EAAGW,UAAY,GACfX,EAAGzB,UAAU9C,EAAgB8B,uBAAuBhB,GACpD,CAEF,CAEDqE,0BACC/J,KAAKyJ,mBACLzJ,KAAKuH,MACL,CAEDyC,qBACC,IAAK,MAAOjI,EAAGwG,KAAQvI,KAAK8H,KAAM,CACjC,MAAMmC,EAAgB1B,EAAIoB,cAAc,cACxC,IAAKM,EAAe,SACpB,MAAMtI,EAAQ4G,EAAI2B,aAAa,SAC/B3B,EAAIlD,UAAUuE,OAAO,SAAU,MAAO,WACtCK,EAAc5E,UAAUuE,OAAO,SAAU,MAAO,WAEhD,MAAMO,EAASnK,KAAKgB,KAAKM,UAAUK,GACnC4G,EAAIlD,UAAUC,IAAI6E,EAAOC,eACzBH,EAAc5E,UAAUC,IAAI6E,EAAOC,eACnCH,EAActB,aAAa,QAAS3I,KAAKgB,KAAKM,UAAUK,GACxD,CACD,CAED0I,4BACCrK,KAAKgK,qBACDhK,KAAK+G,YAAc/G,KAAKmH,aAAanH,KAAKuH,MAC9C,CAED+C,cACCtK,KAAKyJ,mBACLzJ,KAAKgK,oBACL,CAED9B,qBACClI,KAAKyJ,mBACLzJ,KAAKgK,qBACLhK,KAAKuH,MACL,CAEDgD,kBAAkBpD,GACjBnH,KAAKmH,YAAcA,EACfnH,KAAK+G,aACR/G,KAAK+G,WAAWyD,WAAW,GAC3BxK,KAAKuH,OAEN,CAGDA,OACCvH,KAAK8G,MAAMgD,UAAY,GACvB9J,KAAK8G,MAAMY,OAAO1H,KAAKyH,YACvB,MAAM5H,EAASG,KAAKqI,aACboC,EAAKC,GAAO1K,KAAK+G,WACrB/G,KAAK+G,WAAW4D,SAAS9K,EAAOoC,QAChC,CAAC,EAAGpC,EAAOoC,QACd,IAAK,IAAI2I,EAAIH,EAAKG,EAAIF,EAAKE,IACtB5K,KAAKgH,WAAWhH,KAAKqJ,QAAQxJ,EAAO+K,GAAG,GAAI5K,KAAK8H,KAAK4B,IAAI7J,EAAO+K,GAAG,KACvE5K,KAAK8G,MAAMY,OAAO1H,KAAK8H,KAAK4B,IAAI7J,EAAO+K,GAAG,IAE3C,CAGDrI,KAAKiB,EAAaxD,KAAKiH,WAAYxD,EAAsBzD,KAAKyD,YAC7DzD,KAAKgB,KAAKuB,KAAKiB,EAAIC,GACnBzD,KAAKuH,MACL,CAGDK,QAAQiD,GACP,IAAIzG,EAAayG,EAAEC,OAAgC1F,UACnDpF,KAAKyD,WAAcW,IAAcpE,KAAKiH,aAAejH,KAAKyD,WAC1DzD,KAAKiH,WAAa7C,EACdpE,KAAK+G,YAAY/G,KAAK+G,WAAWyD,WAAW,GAChDxK,KAAKuC,MACL,CAKD1B,qBAA4DkK,EAAmBC,GAC9E,IAAIC,EAAK/F,SAASC,cAAc6F,GAEhC,OADAD,EAAKrD,OAAOuD,GACLA,CACP,CAEDpK,sBAA6DkK,EAAmBC,GAC/E,IAAIC,EAAK/F,SAASC,cAAc6F,GAGhC,OAFA9F,SAASC,cACT4F,EAAKG,QAAQD,GACNA,CACP,CAEDpK,yBAAgEkK,EAAmBC,EAAShC,GAC3F,IAAIiC,EAAKpE,EAAQiC,cAAciC,EAAMC,GAErC,OADAC,EAAG7F,UAAY4D,EACRiC,CACP,CAEDpK,gBAAgBkK,EAAmB/B,EAAcmC,EAA4BC,GAC5E,IAAIC,EAAKxE,EAAQoC,kBAAkB8B,EAAM,KAAM/B,GAG/C,OAFAqC,EAAGF,QAAUA,EACExH,MAAXyH,GAAsBC,EAAG1C,aAAa,UAAW2C,OAAOF,IACrDC,CACP,CAEDxK,iBAAiBkK,EAAmBxB,GACnC,IAAIV,EAAMhC,EAAQiC,cAAciC,EAAM,OAEtC,OADAlC,EAAIU,IAAMA,EACHV,CACP,EAvOMhC,EAAa2C,cAAG,qLAuMhB3C,EAAA+B,YAAe2C,GAAmBA,EAAOC,QAAQ,KAAM,UCzNjD,MAAOC,EAYpB9L,YAAY+L,EAAsBC,GACjC3L,KAAK0L,aAAeA,EACpB1L,KAAK4L,YAAc,EAEnB5L,KAAK6L,WAAaF,EAClB3L,KAAK8L,WAAaH,EAAKhC,cAAc,yCACrC3J,KAAK+L,WAAaJ,EAAKhC,cAAc,yCACrC3J,KAAKgM,WAAaL,EAAKhC,cAAc,yCAErC3J,KAAK8L,WAAWG,iBAAiB,UAC/BpB,GAAM7K,KAAKkM,sBAAsBhI,OAAQ2G,EAAEC,OAA6BpF,UAC1E1F,KAAK+L,WAAWE,iBAAiB,SAChC,IAAMjM,KAAKkM,sBAAsBlM,KAAK4L,YAAc,KACrD5L,KAAKgM,WAAWC,iBAAiB,SAChC,IAAMjM,KAAKkM,sBAAsBlM,KAAK4L,YAAc,IACrD,CAED/K,cAAc6K,EAAsBC,GACnC,MAAMI,EAAaJ,EAAKQ,YAAYjH,SAASC,cAAc,WAC3D4G,EAAW1G,UAAUC,IAAI,uBACzByG,EAAW/C,KAAO,OAClB+C,EAAW3G,UAAY,OAEvB,MAAMgH,EAAaT,EAAKQ,YAAYjH,SAASC,cAAc,WAC3DiH,EAAW/G,UAAUC,IAAI,uBACzB8G,EAAWpD,KAAO,OAElB,MAAMgD,EAAaL,EAAKQ,YAAYjH,SAASC,cAAc,WAK3D,OAJA6G,EAAW3G,UAAUC,IAAI,uBACzB0G,EAAWhD,KAAO,OAClBgD,EAAW5G,UAAY,OAEhB,IAAIqG,EAAWC,EAAcC,EACpC,CAEDlD,OAAO4D,GAWN,GAVArM,KAAKsM,QAAUC,KAAKC,KAAKH,EAAWrM,KAAK0L,cAGrB,GAAhB1L,KAAKsM,QACRtM,KAAK6L,WAAWxG,UAAUC,IAAI,qBAE9BtF,KAAK6L,WAAWxG,UAAUuE,OAAO,qBAI9B5J,KAAK8L,WAAY,CACpB9L,KAAK8L,WAAWhC,UAAY,GAC5B,IAAK,IAAIc,EAAI,EAAGA,GAAK5K,KAAKsM,QAAS1B,IAAK,CACvC,MAAM6B,EAAavH,SAASC,cAAc,UAC1CsH,EAAWrH,UAAYkG,OAAOV,GAC9B5K,KAAK8L,WAAWpE,OAAO+E,EACvB,CACDzM,KAAK8L,WAAWpG,MAAQ4F,OAAOtL,KAAK4L,YACpC,CAGG5L,KAAK+L,YAAY/L,KAAK+L,WAAWW,gBAAgB,WAAY1M,KAAK4L,aAAe,GAGjF5L,KAAKgM,YAAYhM,KAAKgM,WAAWU,gBAAgB,WAAY1M,KAAK4L,aAAe5L,KAAKsM,QAC1F,CAED9B,WAAWnD,GACVA,EAAOkF,KAAK7B,IAAI,EAAG6B,KAAK9B,IAAIpD,EAAMrH,KAAKsM,UACvCtM,KAAK4L,YAAcvE,CACnB,CAED6E,sBAAsB7E,GACrBrH,KAAKwK,WAAWnD,GAChBsF,QAAQC,IAAI,YACR5M,KAAKoH,cAAcpH,KAAKoH,aAAapH,KAAK4L,YAC9C,CAEDjB,SAAS0B,GAKR,MAAO,EAJMrM,KAAK4L,YAAc,GAAK5L,KAAK0L,aAC7B1L,KAAK0L,aAAe,EAC9Ba,KAAK9B,IAAIzK,KAAK4L,YAAc5L,KAAK0L,aAAcW,GAC/CA,EAEH,EC1EY,MAAOQ,EAYpBlN,YAAYmN,GACX9M,KAAK+M,SAAW,GAChB/M,KAAKgN,WAAaF,EAAOE,YAActN,EAAWU,KAAK0M,EAAOhM,MAC9Dd,KAAKiN,eAAiBH,EAAOG,gBAAkB,IAG/C,MAAMC,EAAahI,SAASyE,cAAc,oBAC1C3J,KAAKmN,YAAcD,GAAYvD,cAAc,+BAC7C3J,KAAKoN,UAAYF,GAAYvD,cAAc,2BAC3C3J,KAAKqN,kBAAiB,GAGtB,MAAMC,EAAetN,KAAKgN,WAAW/M,WACnCU,MAAMX,KAAKuN,WAAWV,EAASW,qBAAsBV,IACjDW,EAAsBzN,KAAKgN,WAAWpM,YAC1CD,MAAMX,KAAKuN,WAAWV,EAASW,qBAAsBV,IACvDxM,QAAQV,IAAI,CAAC0N,EAAcG,IACzBhN,MAAK,EAAEiN,EAAOC,KAAkB3N,KAAKwH,KAAKkG,EAAOC,EAAcb,KAC/DnM,MAAMX,KAAKuN,gBAAW5J,EAAWmJ,KAGnB5H,SAAS0I,OAAOC,MAAM,OAAS,IACvC/L,QAAOgM,GAAOA,EAAI7L,OAAS,IAAGY,SAAQ+K,IAC7C,MAAOG,EAAUrI,GAASkI,EAAOzJ,MAAM,UACvCe,SAAS8I,gBAAgB3I,UAAU4I,OAAOF,EAAmB,QAATrI,GACpD,MAAMuF,EAAK/F,SAASyE,cAAc,yBAA2BoE,GACzD9C,IAAIA,EAAGiD,QAAoB,QAATxI,EAAgB,IAIvCR,SAASiJ,iBAAiB,yBAAyBtL,SAAQoI,GAC1DA,EAAGgB,iBAAiB,UAAU,KAC7B/G,SAAS8I,gBAAgB3I,UAAU4I,OAAOhD,EAAGmD,GAAKnD,EAAwBiD,SAE1EhJ,SAAS0I,OAAS,GAAG3C,EAAGmD,MAAOnD,EAAwBiD,0CAA2D,MAIpH,MAAMG,EAAoBnJ,SAASyE,cAAc,sCAC7C0E,IAEHA,EAAkBpC,iBAAiB,UAAWpB,IAC7C7K,KAAK+M,SAASlK,SAAQyL,GAAWA,EAAQ/D,kBAAkB8D,EAAkBH,UAAS,IAEvFlO,KAAK+M,SAASlK,SAAQyL,GAAWA,EAAQ/D,kBAAkB8D,EAAkBH,YAG9EK,OAAOC,SAAWxO,IAClB,CAEDwH,KAAKxG,EAAM2M,EAAyCb,GACnD,GAAIA,EAAO/M,OACV,IAAK,MAAM0O,KAAa3B,EAAO/M,OAAQ,CACtC,MAAM2O,EAAcf,EACjBA,EAAagB,MAAKC,IAAOA,EAAG5F,MAAQ,KAAOyF,IAC3C,CAAEI,OAAQ7N,EAAKX,WAAWiC,SACzBoM,GAAa1O,KAAK8O,eAAehC,EAAQ4B,EAC7C,MAED,GAAIf,EACH,IAAK,MAAMe,KAAef,EACzB3N,KAAK+O,kBAAkBjC,EAAQ4B,QAGhC1O,KAAK+O,kBAAkBjC,EAAQ,CAAE+B,OAAQ7N,EAAKX,WAAWiC,UAI3DtC,KAAKgB,KAAO,IAAID,EAAKC,GACrBhB,KAAK+M,SAASlK,SAAQyL,IACrBA,EAAQ9G,KAAKxH,KAAKgB,MAClBsN,EAAQ/L,MAAM,IAIXvC,KAAKiN,eAAiB,GAAGjN,KAAKgP,qBAAoB,GACtD9J,SAAS+G,iBAAiB,oBAAoB,IAAM/G,SAAS+J,OAC1DjP,KAAKkP,qBAAuBlP,KAAKgP,wBAEpChP,KAAKqN,kBAAiB,EACtB,CAED5E,SAEKzI,KAAKgB,KAAKmB,QAAU,EACvBnC,KAAKgN,WAAW/M,WAAWQ,MAAKO,IAC/BhB,KAAKgB,KAAKkB,SAASlB,GACnBhB,KAAK+M,SAASlK,SAAQyL,GAAWA,EAAQpG,sBAAqB,IAC5DvH,MAAMX,KAAKuN,WAAWV,EAASW,uBAElCxN,KAAKgN,WAAWzM,YAAYE,MAAKO,IAChChB,KAAKgB,KAAKgC,gBAAgBhC,GAC1BhB,KAAK+M,SAASlK,SAAQyL,GAAWA,EAAQjE,6BAA4B,IACnE1J,MAAMX,KAAKuN,WAAWV,EAASW,sBAEnC,CAEDwB,oBAAoBG,GACnBnP,KAAKoP,SAAWC,YAAYrP,KAAKyI,OAAOtF,KAAKnD,MAAuBA,KAAKiN,gBACpEkC,GAAOnP,KAAKyI,QACjB,CAEDyG,qBACCI,cAActP,KAAKoP,SACnB,CAEDN,eAAehC,EAAQ4B,GACtB,IAAI3H,EACJ,GAAI+F,EAAOpB,aAAe,GAAKoB,EAAO/M,OAAO2O,EAAY1F,MAAQ,IAAIjC,WAAY,CAChF,MAAMwI,EAAmBzC,EAAO/M,OAAO2O,EAAY1F,MAAQ,IAAIjC,WAC/DA,EAAa,IAAI0E,EAAWqB,EAAOpB,aAAc6D,EACjD,CACDvP,KAAK+M,SAAStK,KAAK,IAAIoE,EACtB,IAAKiG,EAAQhG,MAAOgG,EAAO/M,OAAO2O,EAAY1F,MAAQ,IAAIlC,MAAOC,WAAYA,GAC7E2H,GAED,CAEDK,kBAAkBjC,EAAQ4B,GACzB,MAAMjH,EAAcqF,EAAO0C,YACzBrD,YAAYjH,SAASC,cAAc,QAOrC,IAAI4B,EACJ,GAPAU,EAAWpC,UAAUC,IAAI,yBACrBoJ,EAAY1F,OACfvB,EAAWrC,UAAYsJ,EAAY1F,KACnCvB,EAAWkB,aAAa,iBAAkB+F,EAAY1F,OAInD8D,EAAOpB,aAAe,EAAG,CAC5B,MAAM+D,EAAqBhI,EAAW0E,YAAYjH,SAASC,cAAc,SACzEsK,EAAmBpK,UAAUC,IAAI,uBACjCyB,EAAa0E,EAAWiE,OAAO5C,EAAOpB,aAAc+D,EACpD,CAED,MAAME,EAAa7C,EAAO0C,YACxBrD,YAAYjH,SAASC,cAAc,UACjCuJ,EAAY1F,MAAM2G,EAAUhH,aAAa,iBAAkB+F,EAAY1F,MAC3EhJ,KAAK+M,SAAStK,KAAK,IAAIoE,EACtB,IAAKiG,EAAQhG,MAAO6I,EAAW5I,WAAYA,GAC3C2H,GAED,CAEDrB,iBAAiBuC,GACX5P,KAAKmN,cACVnN,KAAKmN,YAAY3H,MAAM8I,QAAUsB,EAAU,SAAW,OACtD,CAEDC,gBAAgBC,EAAahD,GAC5B,GAAI9M,KAAKoN,UAAWpN,KAAKoN,UAAUhI,UAAY0K,MAC1C,CACJ,MAAMC,EAAW7K,SAASC,cAAc,QAGxC,GAFA4K,EAAS3K,UAAY0K,EACrBC,EAAS1K,UAAUC,IAAI,0BACnBwH,GAAQ0C,YACX1C,EAAO0C,YAAYrD,YAAY4D,QACzB,GAAIjD,GAAQ/M,OAClB,IAAK,MAAMiQ,KAAalD,EAAO/M,OAC1B+M,EAAO/M,OAAOiQ,GAAWlJ,OAAOgG,EAAO/M,OAAOiQ,GAAWlJ,MAAMqF,YAAY4D,EAGjF,CACD,CAEDxC,WAAWuC,EAAchD,GACxB,MAAMmD,EAAOjQ,KACb,OAAO6K,IACN8B,QAAQuD,MAAMrF,GACViF,GAAKnD,QAAQwD,KAAKL,GACtBG,EAAKJ,gBAAgBC,GAAOjF,EAAGiC,GAC/BmD,EAAK5C,kBAAiB,GACtB4C,EAAKf,oBAAoB,CAE1B,EAxLMrC,EAAoBW,qBAAG"}